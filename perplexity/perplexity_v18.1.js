javascript:(function()%7B%0Aconst%20d%3Ddocument%3B%0Aconst%20w%3Dm%3D%3Enew%20Promise(r%3D%3EsetTimeout(r%2Cm))%3B%0Aconst%20md%3Dn%3D%3E%7B%0A%20%20if(3%3D%3Dn.nodeType)return%20n.textContent.replace(%2F%5Cs%2B%2Fg%2C%22%20%22)%3B%0A%20%20if(1!%3D%3Dn.nodeType)return%22%22%3B%0A%20%20let%20t%3Dn.tagName.toLowerCase()%2Cc%3D%22%22%3B%0A%20%20Array.from(n.childNodes).forEach(k%3D%3Ec%2B%3Dmd(k))%3B%0A%20%20if(%5B%22p%22%2C%22div%22%2C%22h1%22%2C%22h2%22%2C%22h3%22%2C%22h4%22%5D.includes(t))c%3D%22%5Cn%5Cn%22%2Bc%2B%22%5Cn%5Cn%22%3B%0A%20%20if(%22li%22%3D%3Dt)c%3D%22%5Cn-%20%22%2Bc.trim()%3B%0A%20%20if(%22strong%22%3D%3Dt%7C%7C%22b%22%3D%3Dt)return%22%20**%22%2Bc.trim()%2B%22**%20%22%3B%0A%20%20if(%22em%22%3D%3Dt%7C%7C%22i%22%3D%3Dt)return%22%20*%22%2Bc.trim()%2B%22*%20%22%3B%0A%20%20if(%22a%22%3D%3Dt)return%22%20%5B%22%2Bc.trim()%2B%22%5D(%22%2Bn.href%2B%22)%20%22%3B%0A%20%20if(%22img%22%3D%3Dt)return%22%5Cn!%5Bimg%5D(%22%2Bn.src%2B%22)%5Cn%22%3B%0A%20%20if(%22code%22%3D%3Dt)return%22%20%60%22%2Bc%2B%22%60%20%22%3B%0A%20%20if(%22pre%22%3D%3Dt)return%22%5Cn%60%60%60%5Cn%22%2Bn.innerText%2B%22%5Cn%60%60%60%5Cn%22%3B%0A%20%20if(t.startsWith(%22h%22))return%22%5Cn%22%2B%22%23%22.repeat(parseInt(t%5B1%5D))%2B%22%20%22%2Bc.trim()%2B%22%5Cn%5Cn%22%3B%0A%20%20return%20c%3B%0A%7D%3B%0Aasync%20function%20x()%7B%0A%20%20let%20o%3D%22%23%20Perplexity%20Report%20v18.1%5Cn%5Cn%22%3B%0A%20%20o%2B%3D%22%23%23%20Metadata%5Cn%22%3B%0A%20%20o%2B%3D%22-%20**Date**%3A%20%22%2Bnew%20Date().toISOString()%2B%22%5Cn%22%3B%0A%20%20o%2B%3D%22-%20**URL**%3A%20%22%2Bwindow.location.href%2B%22%5Cn%22%3B%0A%20%20o%2B%3D%22-%20**Title**%3A%20%22%2Bdocument.title%2B%22%5Cn%5Cn---%5Cn%5Cn%22%3B%0A%20%20try%7Blet%20h%3Dd.querySelector(%22h1%22)%3Bif(h)o%2B%3D%22%23%23%20Prompt%5Cn%22%2Bh.innerText.trim()%2B%22%5Cn%5Cn---%5Cn%5Cn%22%3B%7Dcatch(e)%7B%7D%0A%0A%20%20%2F%2F%20PER-MESSAGE%20SOURCES%20(NEW)%0A%20%20try%7B%0A%20%20%20%20let%20sourceButtons%3DArray.from(d.querySelectorAll(%22button%22)).filter(x%3D%3E%2F%5Cd%2B%5Cs%2Bsources%2Fi.test(x.innerText))%3B%0A%20%20%20%20if(sourceButtons.length%3E0)%7B%0A%20%20%20%20%20%20o%2B%3D%22%23%23%20Per-Message%20Sources%5Cn%22%3B%0A%20%20%20%20%20%20for(let%20i%3D0%3Bi%3CsourceButtons.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20let%20btn%3DsourceButtons%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20let%20sourceCount%3Dbtn.innerText.match(%2F%5Cd%2B%2F)%5B0%5D%3B%0A%20%20%20%20%20%20%20%20o%2B%3D%60%23%23%23%20Message%20%24%7Bi%2B1%7D%20(%24%7BsourceCount%7D%20sources)%5Cn%60%3B%0A%20%20%20%20%20%20%20%20btn.click()%3B%0A%20%20%20%20%20%20%20%20await%20w(2000)%3B%0A%20%20%20%20%20%20%20%20let%20sl%3Dd.querySelectorAll(%22div.h-full%20a%22)%3B%0A%20%20%20%20%20%20%20%20if(sl.length)%7B%0A%20%20%20%20%20%20%20%20%20%20let%20u%3Dnew%20Set()%3B%0A%20%20%20%20%20%20%20%20%20%20sl.forEach(l%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(l.href%26%26!l.href.includes(%22perplexity%22)%26%26!u.has(l.href))%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20u.add(l.href)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%2B%3D%60*%20%5B%24%7Bl.innerText.split(%22%5Cn%22)%5B0%5D%7D%5D(%24%7Bl.href%7D)%5Cn%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20let%20cls%3Dd.querySelector('button%5Bdata-testid%3D%22close-modal%22%5D')%7C%7Cd.querySelector('button%5Baria-label%3D%22Close%22%5D')%3B%0A%20%20%20%20%20%20%20%20if(cls)%7B%0A%20%20%20%20%20%20%20%20%20%20cls.click()%3B%0A%20%20%20%20%20%20%20%20%20%20await%20w(1000)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20o%2B%3D%22%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20o%2B%3D%22---%5Cn%5Cn%22%3B%0A%20%20%20%20%7D%0A%20%20%7Dcatch(e)%7B%0A%20%20%20%20o%2B%3D%22%3E%20Error%20extracting%20per-message%20sources%5Cn%22%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20SIDEBAR%20SOURCES%20(legacy%20-%20first%20button%20only)%0A%20%20try%7B%0A%20%20%20%20let%20sb%3DArray.from(d.querySelectorAll(%22button%22)).find(x%3D%3E%2F%5Cd%2B%5Cs%2Bsources%2Fi.test(x.innerText))%3B%0A%20%20%20%20if(sb)%7B%0A%20%20%20%20%20%20sb.click()%3B%0A%20%20%20%20%20%20await%20w(2000)%3B%0A%20%20%20%20%20%20let%20sl%3Dd.querySelectorAll(%22div.h-full%20a%22)%3B%0A%20%20%20%20%20%20if(sl.length)%7B%0A%20%20%20%20%20%20%20%20o%2B%3D%22%23%23%20All%20Sources%20(Combined)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20let%20u%3Dnew%20Set()%3B%0A%20%20%20%20%20%20%20%20sl.forEach(l%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20if(l.href%26%26!l.href.includes(%22perplexity%22)%26%26!u.has(l.href))%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20u.add(l.href)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20o%2B%3D%60*%20%5B%24%7Bl.innerText.split(%22%5Cn%22)%5B0%5D%7D%5D(%24%7Bl.href%7D)%5Cn%60%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20o%2B%3D%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20let%20cls%3Dd.querySelector('button%5Bdata-testid%3D%22close-modal%22%5D')%7C%7Cd.querySelector('button%5Baria-label%3D%22Close%22%5D')%3B%0A%20%20%20%20%20%20if(cls)%7Bcls.click()%3Bawait%20w(1000)%7Delse%7Bconsole.log(%22Close%20btn%20missing%22)%7D%0A%20%20%20%20%7D%0A%20%20%7Dcatch(e)%7Bo%2B%3D%22%3E%20Error%20Sidebar%5Cn%22%7D%0A%0A%20%20try%7B%0A%20%20%20%20let%20c%3Dd.querySelectorAll('%5Bid%5E%3D%22markdown-content%22%5D')%3B%0A%20%20%20%20if(c.length)%7B%0A%20%20%20%20%20%20o%2B%3D%22%23%23%20Answer%5Cn%22%3B%0A%20%20%20%20%20%20const%20artifacts%3D%5B%22Chart%22%2C%22Code%20Interpreter%20Graph%22%2C%22Code%20Interpreter%22%2C%22Programming%2C%20Chart%22%5D%3B%0A%20%20%20%20%20%20c.forEach(z%3D%3E%7B%0A%20%20%20%20%20%20%20%20let%20text%3Dmd(z)%3B%0A%20%20%20%20%20%20%20%20text%3Dtext.split('%5Cn').filter(line%3D%3E%7Bconst%20trimmed%3Dline.trim()%3Breturn!artifacts.some(a%3D%3Etrimmed%3D%3D%3Da)%7D).join('%5Cn')%3B%0A%20%20%20%20%20%20%20%20text%3Dtext.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%22%5Cn%5Cn%22)%3B%0A%20%20%20%20%20%20%20%20o%2B%3Dtext%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20o%2B%3D%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%7D%0A%20%20%7Dcatch(e)%7B%7D%0A%20%20try%7B%0A%20%20%20%20let%20ti%3DArray.from(d.querySelectorAll(%22button%5Brole%3D'tab'%5D%2C%20div%5Brole%3D'tab'%5D%22)).find(t%3D%3E%2FImages%7CMedia%2Fi.test(t.innerText)%7C%7Ct.querySelector('use%5Bxlink%5C%5C%3Ahref*%3D%22icon-image%22%5D'))%3B%0A%20%20%20%20if(ti)%7B%0A%20%20%20%20%20%20o%2B%3D%22%23%23%20Images%5Cn%22%3B%0A%20%20%20%20%20%20ti.click()%3Bawait%20w(2500)%3B%0A%20%20%20%20%20%20let%20attempts%3D0%3Blet%20maxAttempts%3D20%3B%0A%20%20%20%20%20%20while(attempts%3CmaxAttempts)%7B%0A%20%20%20%20%20%20%20%20let%20loadedCount%3DArray.from(d.querySelectorAll(%22img%5Bsrc*%3D'http'%5D%22)).filter(img%3D%3Eimg.complete%26%26img.naturalWidth%3E0).length%3B%0A%20%20%20%20%20%20%20%20if(loadedCount%3E0)break%3B%0A%20%20%20%20%20%20%20%20await%20w(500)%3Battempts%2B%2B%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20let%20im%3Dd.querySelectorAll(%22img%22)%3B%0A%20%20%20%20%20%20let%20us%3Dnew%20Set()%3B%0A%20%20%20%20%20%20im.forEach(m%3D%3E%7B%0A%20%20%20%20%20%20%20%20if(m.src%26%26!m.src.includes(%22favicon%22)%26%26m.naturalWidth%3E100%26%26!us.has(m.src))%7B%0A%20%20%20%20%20%20%20%20%20%20us.add(m.src)%3B%0A%20%20%20%20%20%20%20%20%20%20o%2B%3D%22!%5Bref%5D(%22%2Bm.src%2B%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%0A%20%20%7Dcatch(e)%7B%7D%0A%20%20try%7B%0A%20%20%20%20const%20relatedSelectors%3D%5B'%5Bdata-testid%3D%22related-questions%22%5D'%2C'.related-questions'%2C'%5Bclass*%3D%22related%22%5D'%2C'%5Bclass*%3D%22follow-up%22%5D'%2C'%5Bclass*%3D%22followup%22%5D'%5D%3B%0A%20%20%20%20for(const%20selector%20of%20relatedSelectors)%7B%0A%20%20%20%20%20%20const%20rq%3Dd.querySelector(selector)%3B%0A%20%20%20%20%20%20if(rq)%7B%0A%20%20%20%20%20%20%20%20const%20questions%3Drq.querySelectorAll('a%2C%20button%2C%20%5Brole%3D%22button%22%5D')%3B%0A%20%20%20%20%20%20%20%20if(questions.length%3E0)%7B%0A%20%20%20%20%20%20%20%20%20%20o%2B%3D%22%5Cn---%5Cn%5Cn%23%23%20Related%20Questions%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20questions.forEach((q%2Ci)%3D%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20text%3Dq.innerText.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(text%26%26text.length%3E10)%7Bo%2B%3D(i%2B1)%2B%22.%20%22%2Btext%2B%22%5Cn%22%7D%0A%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20o%2B%3D%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7Dcatch(e)%7B%7D%0A%20%20let%20bl%3Dnew%20Blob(%5Bo.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%22%5Cn%5Cn%22)%5D%2C%7Btype%3A%22text%2Fmarkdown%22%7D)%2Cel%3Dd.createElement(%22a%22)%3B%0A%20%20el.href%3DURL.createObjectURL(bl)%3B%0A%20%20el.download%3D%22perplexity_v18.1_%22%2Bnew%20Date().toISOString().slice(0%2C10)%2B%22.md%22%3B%0A%20%20d.body.appendChild(el)%3B%0A%20%20el.click()%3B%0A%20%20d.body.removeChild(el)%3B%0A%7D%0Ax()%3B%0A%7D)()%3B