javascript:%20%28function%20%28%29%20%7B%20const%20d%20=%20document;%20const%20w%20=%20m%20=%3E%20new%20Promise%28r%20=%3E%20setTimeout%28r,%20m%29%29;%20const%20md%20=%20n%20=%3E%20%7B%20if%20%283%20==%20n.nodeType%29%20return%20n.textContent.replace%28/\s+/g,%20%22%20%22%29;%20if%20%281%20!==%20n.nodeType%29%20return%20%22%22;%20let%20t%20=%20n.tagName.toLowerCase%28%29,%20c%20=%20%22%22;%20Array.from%28n.childNodes%29.forEach%28k%20=%3E%20c%20+=%20md%28k%29%29;%20if%20%28%5B%22p%22,%20%22div%22,%20%22h1%22,%20%22h2%22,%20%22h3%22,%20%22h4%22%5D.includes%28t%29%29%20c%20=%20%22\n\n%22%20+%20c%20+%20%22\n\n%22;%20if%20%28%22li%22%20==%20t%29%20c%20=%20%22\n-%20%22%20+%20c.trim%28%29;%20if%20%28%22strong%22%20==%20t%20%7C%7C%20%22b%22%20==%20t%29%20return%20%22%20**%22%20+%20c.trim%28%29%20+%20%22**%20%22;%20if%20%28%22em%22%20==%20t%20%7C%7C%20%22i%22%20==%20t%29%20return%20%22%20*%22%20+%20c.trim%28%29%20+%20%22*%20%22;%20if%20%28%22a%22%20==%20t%29%20return%20%22%20%5B%22%20+%20c.trim%28%29%20+%20%22%5D%28%22%20+%20n.href%20+%20%22%29%20%22;%20if%20%28%22img%22%20==%20t%29%20return%20%22\n!%5Bimg%5D%28%22%20+%20n.src%20+%20%22%29\n%22;%20if%20%28%22code%22%20==%20t%29%20return%20%22%20`%22%20+%20c%20+%20%22`%20%22;%20if%20%28%22pre%22%20==%20t%29%20return%20%22\n```\n%22%20+%20n.innerText%20+%20%22\n```\n%22;%20if%20%28t.startsWith%28%22h%22%29%29%20return%20%22\n%22%20+%20%22#%22.repeat%28parseInt%28t%5B1%5D%29%29%20+%20%22%20%22%20+%20c.trim%28%29%20+%20%22\n\n%22;%20return%20c;%20%7D;%20async%20function%20x%28%29%20%7B%20let%20o%20=%20%22#%20Perplexity%20Report%20v18.2\n\n%22;%20o%20+=%20%22##%20Metadata\n%22;%20o%20+=%20%22-%20**Date**:%20%22%20+%20new%20Date%28%29.toISOString%28%29%20+%20%22\n%22;%20o%20+=%20%22-%20**URL**:%20%22%20+%20window.location.href%20+%20%22\n%22;%20o%20+=%20%22-%20**Title**:%20%22%20+%20document.title%20+%20%22\n\n---\n\n%22;%20try%20%7B%20let%20h%20=%20d.querySelector%28%22h1%22%29;%20if%20%28h%29%20o%20+=%20%22##%20Prompt\n%22%20+%20h.innerText.trim%28%29%20+%20%22\n\n---\n\n%22;%20%7D%20catch%20%28e%29%20%7B%7D%20try%20%7B%20let%20reasoningButtons%20=%20Array.from%28d.querySelectorAll%28%22button%22%29%29%20.filter%28x%20=%3E%20/\d+\s+steps\s+completed/i.test%28x.innerText%29%29;%20if%20%28reasoningButtons.length%20%3E%200%29%20%7B%20o%20+=%20%22##%20Per-Message%20Reasoning\n%22;%20for%20%28let%20i%20=%200;%20i%20%3C%20reasoningButtons.length;%20i++%29%20%7B%20let%20btn%20=%20reasoningButtons%5Bi%5D;%20let%20stepCount%20=%20btn.innerText.match%28/\d+/%29%5B0%5D;%20o%20+=%20%22###%20Message%20%22%20+%20%28i%20+%201%29%20+%20%22%20%28%22%20+%20stepCount%20+%20%22%20steps%29\n%22;%20let%20parentContainer%20=%20btn.closest%28%27div%5Bclass*=%22flex%22%5D,%20div%5Bclass*=%22gap%22%5D,%20div%5Bclass*=%22col%22%5D%27%29;%20btn.click%28%29;%20await%20w%283000%29;%20%20let%20reasoningFound%20=%20false;%20if%20%28parentContainer%29%20%7B%20let%20siblings%20=%20Array.from%28parentContainer.parentElement.children%29;%20let%20buttonIndex%20=%20siblings.indexOf%28parentContainer%29;%20for%20%28let%20j%20=%20buttonIndex%20+%201;%20j%20%3C%20siblings.length%20&&%20j%20%3C%20buttonIndex%20+%2010;%20j++%29%20%7B%20let%20sibling%20=%20siblings%5Bj%5D;%20let%20text%20=%20sibling.innerText%20%7C%7C%20%22%22;%20if%20%28text.includes%28%22Searched%22%29%20%7C%7C%20text.includes%28%22Step%22%29%20%7C%7C%20text.includes%28%22Found%22%29%20%7C%7C%20text.includes%28%22Query%22%29%29%20%7B%20let%20lines%20=%20text.split%28%22\n%22%29%20.filter%28l%20=%3E%20l.trim%28%29.length%20%3E%205%29%20.slice%280,%2030%29;%20%20if%20%28lines.length%20%3E%200%29%20%7B%20lines.forEach%28line%20=%3E%20%7B%20o%20+=%20line.trim%28%29%20+%20%22\n%22;%20%7D%29;%20reasoningFound%20=%20true;%20break;%20%7D%20%7D%20%7D%20%7D%20if%20%28!reasoningFound%29%20%7B%20let%20nearbyElements%20=%20d.querySelectorAll%28%27%5Bclass*=%22reasoning%22%5D,%20%5Bclass*=%22step%22%5D,%20%5Bdata-reasoning%5D%27%29;%20nearbyElements.forEach%28el%20=%3E%20%7B%20if%20%28el.offsetParent%20!==%20null%20&&%20el.innerText.length%20%3E%2050%20&&%20el.innerText.length%20%3C%205000%29%20%7B%20o%20+=%20el.innerText.trim%28%29%20+%20%22\n%22;%20reasoningFound%20=%20true;%20%7D%20%7D%29;%20%7D%20if%20%28!reasoningFound%29%20%7B%20let%20grandParent%20=%20btn.parentElement?.parentElement;%20if%20%28grandParent%29%20%7B%20let%20allText%20=%20grandParent.innerText;%20let%20stepsIndex%20=%20allText.indexOf%28%22steps%20completed%22%29;%20if%20%28stepsIndex%20%3E=%200%29%20%7B%20let%20afterSteps%20=%20allText.substring%28stepsIndex%20+%2014%29.trim%28%29;%20let%20lines%20=%20afterSteps.split%28%22\n%22%29%20.filter%28l%20=%3E%20l.trim%28%29.length%20%3E%205%29%20.slice%280,%2020%29;%20if%20%28lines.length%20%3E%200%29%20%7B%20lines.forEach%28line%20=%3E%20%7B%20if%20%28!line.includes%28%22sources%22%29%20&&%20!line.includes%28%22citations%22%29%29%20%7B%20o%20+=%20line.trim%28%29%20+%20%22\n%22;%20%7D%20%7D%29;%20reasoningFound%20=%20true;%20%7D%20%7D%20%7D%20%7D%20if%20%28!reasoningFound%29%20%7B%20o%20+=%20%22%3E%20Unable%20to%20extract%20reasoning%20content\n%22;%20%7D%20o%20+=%20%22\n%22;%20%7D%20o%20+=%20%22---\n\n%22;%20%7D%20%7D%20catch%20%28e%29%20%7B%20console.log%28%22Error%20extracting%20reasoning:%22,%20e%29;%20o%20+=%20%22%3E%20Error%20extracting%20per-message%20reasoning\n%22;%20%7D%20try%20%7B%20let%20sourceButtons%20=%20Array.from%28d.querySelectorAll%28%22button%22%29%29%20.filter%28x%20=%3E%20/\d+\s+sources/i.test%28x.innerText%29%29;%20if%20%28sourceButtons.length%20%3E%200%29%20%7B%20o%20+=%20%22##%20Per-Message%20Sources\n%22;%20for%20%28let%20i%20=%200;%20i%20%3C%20sourceButtons.length;%20i++%29%20%7B%20let%20btn%20=%20sourceButtons%5Bi%5D;%20let%20sourceCount%20=%20btn.innerText.match%28/\d+/%29%5B0%5D;%20o%20+=%20%22###%20Message%20%22%20+%20%28i%20+%201%29%20+%20%22%20%28%22%20+%20sourceCount%20+%20%22%20sources%29\n%22;%20btn.click%28%29;%20await%20w%282000%29;%20let%20sl%20=%20d.querySelectorAll%28%22div.h-full%20a%22%29;%20if%20%28sl.length%29%20%7B%20let%20u%20=%20new%20Set%28%29;%20sl.forEach%28l%20=%3E%20%7B%20if%20%28l.href%20&&%20!l.href.includes%28%22perplexity%22%29%20&&%20!u.has%28l.href%29%29%20%7B%20u.add%28l.href%29;%20o%20+=%20%22*%20%5B%22%20+%20l.innerText.split%28%22\n%22%29%5B0%5D%20+%20%22%5D%28%22%20+%20l.href%20+%20%22%29\n%22;%20%7D%20%7D%29;%20%7D%20let%20cls%20=%20d.querySelector%28%27button%5Bdata-testid=%22close-modal%22%5D%27%29%20%7C%7C%20d.querySelector%28%27button%5Baria-label=%22Close%22%5D%27%29;%20if%20%28cls%29%20%7B%20cls.click%28%29;%20await%20w%281000%29;%20%7D%20o%20+=%20%22\n%22;%20%7D%20o%20+=%20%22---\n\n%22;%20%7D%20%7D%20catch%20%28e%29%20%7B%20o%20+=%20%22%3E%20Error%20extracting%20per-message%20sources\n%22;%20%7D%20try%20%7B%20let%20sb%20=%20Array.from%28d.querySelectorAll%28%22button%22%29%29.find%28x%20=%3E%20/\d+\s+sources/i.test%28x.innerText%29%29;%20if%20%28sb%29%20%7B%20sb.click%28%29;%20await%20w%282000%29;%20let%20sl%20=%20d.querySelectorAll%28%22div.h-full%20a%22%29;%20if%20%28sl.length%29%20%7B%20o%20+=%20%22##%20All%20Sources%20%28Combined%29\n%22;%20let%20u%20=%20new%20Set%28%29;%20sl.forEach%28l%20=%3E%20%7B%20if%20%28l.href%20&&%20!l.href.includes%28%22perplexity%22%29%20&&%20!u.has%28l.href%29%29%20%7B%20u.add%28l.href%29;%20o%20+=%20%22*%20%5B%22%20+%20l.innerText.split%28%22\n%22%29%5B0%5D%20+%20%22%5D%28%22%20+%20l.href%20+%20%22%29\n%22;%20%7D%20%7D%29;%20o%20+=%20%22\n---\n\n%22;%20%7D%20let%20cls%20=%20d.querySelector%28%27button%5Bdata-testid=%22close-modal%22%5D%27%29%20%7C%7C%20d.querySelector%28%27button%5Baria-label=%22Close%22%5D%27%29;%20if%20%28cls%29%20%7B%20cls.click%28%29;%20await%20w%281000%29;%20%7D%20else%20%7B%20console.log%28%22Close%20btn%20missing%22%29;%20%7D%20%7D%20%7D%20catch%20%28e%29%20%7B%20o%20+=%20%22%3E%20Error%20Sidebar\n%22;%20%7D%20try%20%7B%20let%20c%20=%20d.querySelectorAll%28%27%5Bid^=%22markdown-content%22%5D%27%29;%20if%20%28c.length%29%20%7B%20o%20+=%20%22##%20Answer\n%22;%20const%20artifacts%20=%20%5B%22Chart%22,%20%22Code%20Interpreter%20Graph%22,%20%22Code%20Interpreter%22,%20%22Programming,%20Chart%22%5D;%20c.forEach%28z%20=%3E%20%7B%20let%20text%20=%20md%28z%29;%20text%20=%20text.split%28%27\n%27%29%20.filter%28line%20=%3E%20%7B%20const%20trimmed%20=%20line.trim%28%29;%20return%20!artifacts.some%28a%20=%3E%20trimmed%20===%20a%29;%20%7D%29%20.join%28%27\n%27%29;%20text%20=%20text.replace%28/\n%7B3,%7D/g,%20%27\n\n%27%29;%20o%20+=%20text;%20%7D%29;%20o%20+=%20%22\n---\n\n%22;%20%7D%20%7D%20catch%20%28e%29%20%7B%7D%20try%20%7B%20let%20ti%20=%20Array.from%28d.querySelectorAll%28%22button%5Brole=%27tab%27%5D,%20div%5Brole=%27tab%27%5D%22%29%29%20.find%28t%20=%3E%20/Images%7CMedia/i.test%28t.innerText%29%20%7C%7C%20t.querySelector%28%27use%5Bxlink\\:href*=%22icon-image%22%5D%27%29%29;%20if%20%28ti%29%20%7B%20o%20+=%20%22##%20Images\n%22;%20ti.click%28%29;%20await%20w%282500%29;%20let%20attempts%20=%200;%20let%20maxAttempts%20=%2020;%20while%20%28attempts%20%3C%20maxAttempts%29%20%7B%20let%20loadedCount%20=%20Array.from%28d.querySelectorAll%28%22img%5Bsrc*=%27http%27%5D%22%29%29%20.filter%28img%20=%3E%20img.complete%20&&%20img.naturalWidth%20%3E%200%29.length;%20if%20%28loadedCount%20%3E%200%29%20break;%20await%20w%28500%29;%20attempts++;%20%7D%20let%20im%20=%20d.querySelectorAll%28%22img%22%29;%20let%20us%20=%20new%20Set%28%29;%20im.forEach%28m%20=%3E%20%7B%20if%20%28m.src%20&&%20!m.src.includes%28%22favicon%22%29%20&&%20m.naturalWidth%20%3E%20100%20&&%20!us.has%28m.src%29%29%20%7B%20us.add%28m.src%29;%20o%20+=%20%22!%5Bref%5D%28%22%20+%20m.src%20+%20%22%29\n%22;%20%7D%20%7D%29;%20%7D%20%7D%20catch%20%28e%29%20%7B%7D%20try%20%7B%20const%20relatedSelectors%20=%20%5B%20%27%5Bdata-testid=%22related-questions%22%5D%27,%20%27.related-questions%27,%20%27%5Bclass*=%22related%22%5D%27,%20%27%5Bclass*=%22follow-up%22%5D%27,%20%27%5Bclass*=%22followup%22%5D%27%20%5D;%20for%20%28const%20selector%20of%20relatedSelectors%29%20%7B%20const%20rq%20=%20d.querySelector%28selector%29;%20if%20%28rq%29%20%7B%20const%20questions%20=%20rq.querySelectorAll%28%27a,%20button,%20%5Brole=%22button%22%5D%27%29;%20if%20%28questions.length%20%3E%200%29%20%7B%20o%20+=%20%22\n---\n\n##%20Related%20Questions\n%22;%20questions.forEach%28%28q,%20i%29%20=%3E%20%7B%20const%20text%20=%20q.innerText.trim%28%29;%20if%20%28text%20&&%20text.length%20%3E%2010%29%20%7B%20o%20+=%20%28i%20+%201%29%20+%20%22.%20%22%20+%20text%20+%20%22\n%22;%20%7D%20%7D%29;%20o%20+=%20%22\n---\n\n%22;%20break;%20%7D%20%7D%20%7D%20%7D%20catch%20%28e%29%20%7B%7D%20let%20bl%20=%20new%20Blob%28%5Bo.replace%28/\n%7B3,%7D/g,%20%22\n\n%22%29%5D,%20%7B%20type:%20%22text/markdown%22%20%7D%29,%20el%20=%20d.createElement%28%22a%22%29;%20el.href%20=%20URL.createObjectURL%28bl%29;%20el.download%20=%20%22perplexity_v18.2_%22%20+%20new%20Date%28%29.toISOString%28%29.slice%280,%2010%29%20+%20%22.md%22;%20d.body.appendChild%28el%29;%20el.click%28%29;%20d.body.removeChild%28el%29;%20%7D%20x%28%29;%7D%29%28%29;
