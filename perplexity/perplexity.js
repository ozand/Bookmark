javascript:(function(){const d=document;const w=m=>new Promise(r=>setTimeout(r,m));const md=n=>{if(3==n.nodeType)return n.textContent.replace(/\s+/g," ");if(1!==n.nodeType)return"";let t=n.tagName.toLowerCase(),c="";Array.from(n.childNodes).forEach(k=>c+=md(k));if(["p","div","h1","h2","h3","h4"].includes(t))c="\n\n"+c+"\n\n";if("li"==t)c="\n- "+c.trim();if("strong"==t||"b"==t)return" **"+c.trim()+"** ";if("em"==t||"i"==t)return" *"+c.trim()+"* ";if("a"==t)return` [${c.trim()}](${n.href}) `;if("img"==t)return`\n![img](${n.src})\n`;if("code"==t)return" `"+c+"` ";if("pre"==t)return"\n```\n"+n.innerText+"\n```\n";if(t.startsWith("h"))return"\n"+"#".repeat(parseInt(t[1]))+"%20"+c.trim()+"\n\n";return%20c};async%20function%20x(){let%20o="#%20Perplexity%20Report%20v17\n\n";try{let%20h=d.querySelector("h1");if(h)o+="##%20Prompt\n"+h.innerText.trim()+"\n\n---\n\n"}catch(e){}try{let%20b=Array.from(d.querySelectorAll("button")).find(x=>/steps|reasoning/i.test(x.innerText));if(b){b.click();await%20w(1000);let%20gs=d.querySelectorAll(".group\\/goal");if(gs.length){o+="##%20Reasoning\n";gs.forEach((g,i)=>{let%20t=g.querySelector(".pr-sm");if(t&&t.innerText.trim()!=="Finished"){o+=`###%20Step%20${i+1}\n${t.innerText.trim()}\n\n`;let%20sq=Array.from(g.querySelectorAll(".bg-subtler"));if(sq.length){let%20qt=sq.map(el=>el.innerText.replace(/search/gi,"").trim()).filter(t=>t.length>0);if(qt.length)o+=`>%20**Queries:**%20${qt.join(",%20")}\n\n`}let%20l=Array.from(g.querySelectorAll("a"));if(l.length)o+=l.map(z=>`-%20[${z.innerText.replace(/\n/g,"%20")}](${z.href})`).join("\n")+"\n";o+="\n"}});o+="---\n\n"}}}catch(e){}try{let%20sb=Array.from(d.querySelectorAll("button")).find(x=>/\d+\s+sources/i.test(x.innerText));if(sb){sb.click();await%20w(2000);let%20sl=d.querySelectorAll("div.h-full%20a");if(sl.length){o+="##%20Sidebar%20Sources\n";let%20u=new%20Set();sl.forEach(l=>{if(l.href&&!l.href.includes("perplexity")&&!u.has(l.href)){u.add(l.href);o+=`*%20[${l.innerText.split("\n")[0]}](${l.href})\n`}});o+="\n---\n\n"}let%20cls=d.querySelector('button[data-testid="close-modal"]')||d.querySelector('button[aria-label="Close"]');if(cls){cls.click();await%20w(1000)}else{console.log("Close%20btn%20missing")}}}catch(e){o+=">%20Error%20Sidebar\n"}try{let%20c=d.querySelectorAll('[id^="markdown-content"]');if(c.length){o+="##%20Answer\n";c.forEach(z=>o+=md(z));o+="\n---\n\n"}}catch(e){}try{let%20ti=Array.from(d.querySelectorAll("button[role='tab'],%20div[role='tab']")).find(t=>/Images|Media/i.test(t.innerText)||t.querySelector('use[xlink\\:href*="icon-image"]'));if(ti){o+="##%20Images\n";ti.click();await%20w(2500);for(let%20i=0;i<10;i++){if(d.querySelector("img[src*='http']"))break;await%20w(500)}let%20im=d.querySelectorAll("img");let%20us=new%20Set();im.forEach(m=>{if(m.src&&!m.src.includes("favicon")&&m.naturalWidth>100&&!us.has(m.src)){us.add(m.src);o+=`![ref](${m.src})\n`}})}}catch(e){}let%20bl=new%20Blob([o.replace(/\n{3,}/g,"\n\n")],{type:"text/markdown"}),el=d.createElement("a");el.href=URL.createObjectURL(bl);el.download="perplexity_v17_"+new%20Date().toISOString().slice(0,10)+".md";d.body.appendChild(el);el.click();d.body.removeChild(el)}x()})();