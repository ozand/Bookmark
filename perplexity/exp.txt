> также у каждого сообщения нужно получать данные о размышление.
отображение их инициируется нажатием на кнопку
``
<div class="flex flex-col gap-sm"><button class="gap-x-0.5 flex items-center whitespace-nowrap text-quiet text-sm">7 steps completed<span class="duration-quick inline-block
transition-transform ease-in-out text-quiet rotate-0"><svg role="img" class="inline-flex fill-current" width="14" height="14"><use
xlink:href="#pplx-icon-chevron-right"></use></svg></span></button></div>
```
после нажатия происходят изменение
```
<button class="gap-x-0.5 flex items-center whitespace-nowrap text-quiet text-sm">7 steps completed<span class="duration-quick inline-block transition-transform ease-in-out
text-quiet rotate-90"><svg role="img" class="inline-flex fill-current" width="14" height="14"><use xlink:href="#pplx-icon-chevron-right"></use></svg></span></button>
```
  ⎿  Interrupted · What should Claude do instead?

> вот так выглядит код одного блока
``
<div class="mx-auto max-w-threadContentWidth"><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-default"
id="radix-:r4l:-content-default" tabindex="0" class="focus:outline-none" style=""><div class="gap-y-md mt-md flex flex-col"><div dir="ltr" data-orientation="horizontal"
class="grid w-full min-w-0 grid-cols-[minmax(0,1fr)]"><div style="opacity: 1;" class="col-start-1 row-start-2"><div data-state="active" data-orientation="horizontal"
role="tabpanel" aria-labelledby="radix-:rqo:-trigger-thread" id="radix-:rqo:-content-thread" tabindex="0" class="focus:outline-none" style=""><div class="border-subtlest
ring-subtlest divide-subtlest bg-transparent"><div class="gap-y-md flex flex-col"><div class="flex flex-col gap-sm"><button class="gap-x-0.5 flex items-center
whitespace-nowrap text-quiet text-sm">6 steps completed<span class="duration-quick inline-block transition-transform ease-in-out text-quiet rotate-0"><svg role="img"
class="inline-flex fill-current" width="14" height="14"><use xlink:href="#pplx-icon-chevron-right"></use></svg></span></button></div><div class="relative font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><div class="min-w-0 break-words
[word-break:break-word]"><div dir="auto" id="markdown-content-2" class="gap-y-md after:clear-both after:block after:content-['']"><div class="my-2 first:mt-0
[&amp;:has([data-inline-type=image])+&amp;:has([data-inline-type=image])_[data-inline-type=image]]:hidden [&amp;:has(table)_[data-inline-type=image]]:hidden"><div
class="relative"><div class="prose dark:prose-invert inline leading-relaxed break-words min-w-0 [word-break:break-word] prose-strong:font-medium
[&amp;_&gt;*:first-child]:mt-0"><p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Now I'll create a comprehensive professional
report for the user.</p>
<hr class="bg-subtle h-px border-0" node="[object Object]">
<h2 cler"><a rel="noopener" class="inline" target="_blank"
href="https://opensource-db.com/pg18-hacktober-31-days-of-new-features-skip-scan-on-multicolumn-b-tree-indexes/"><span class="relative -mt-px select-none whitespace-nowrap
-top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs
rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">opensource-db</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span
class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Индекс: CREATE INDEX idx_sales ON sales(region, category, date);</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">--
Запрос</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> sales
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> category </span><span
class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'Electronics'</span><span> </span><span class="token token
operator">AND</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span> </span><span class="token token
operator">&gt;</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">В PostgreSQL 17 этот запрос игнорировал индекс, потому что <code>region</code>
 (первый столбец) не был указан.</p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">PostgreSQL 18 с skip scan решает эту проблему, внутренне генерируя
динамические условия равенства для каждого уникального значения пропущенного столбца:<span class="inline-flex" data-state="closed"><span class="citation-nbsp"></span><span
class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.pgedge.com/blog/postgres-18-skip-scan-breaking-free-from-the-left-most-index-limitation"><span class="relative -mt-px select-none whitespace-nowrap -top-px
font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge
group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">pgedge</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span
class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>FOR EACH region_value IN (SELECT DISTINCT region FROM sales):
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">    SEARCH INDEX WHERE region = region_value
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                      AND category = 'Electronics'
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                      AND date &gt; '2024-01-01'
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); backgrounирован как сбалансированное дерево с корневой страницей,
промежуточными узлами и листовыми страницами, содержащими фактические значения и указатели на данные таблицы.<span class="inline-flex" aria-label="Documentation: 18: 11.3.
Multicolumn Indexes" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline"
target="_blank" href="https://www.postgresql.org/docs/current/indexes-multicolumn.html"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">postgresql</span></span></span></a></span>​</span></p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Традиционное сканирование:</p>
<ol class="marker:text-quiet list-decimal">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Входит в индекс через корневую страницу</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Навигирует по промежуточным узлам, используя ведущие столбцы</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Достигает листовых страниц</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Сканирует все листовые страницы последовательно</p>
</li>
</ol>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan переопределяет этот процесс:</p>
<ol class="marker:text-quiet list-decimal">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Идентифицирует все уникальные значения в пропущенном столбце (например, через
статистику <code>pg_stats</code>)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Для каждого значения пропущенного столбца:</p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Позиционируется в B-tree, используя полное составное условие
(пропущенный_столбец = текущее_значение AND остальные_условия)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Читает только релевантные листовые страницы для этого значения</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Прыгает (skips) к следующему значению пропущенного столбца</strong>,
минуя промежуточные листовые страницы</p>
</li>
</ul>
</li>
</ol>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">C. Конкретный пример из PostgreSQL документации</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Официальный пример из PostgreSQL 18 документации показывает skip scan в
действии:<span class="inline-flex" aria-label="Documentation: 18: 14.1. Using EXPLAIN" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://www.postgresql.org/docs/current/using-explain.html"><span class="relative -mt-px
select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">postgresql</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Создание индекса с низкой кардинальностью на ведущий столбец</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_tenk1_four_unique1 </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> tenk1</span><span class="token token punctuation">(</span><span>four</span><span class="token token
punctuation">,</span><span> unique1</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- four имеет 4
уникальных значения (0, 1, 2, 3)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- unique1 имеет
10000 уникальных значений</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос БЕЗ условия на four
(ведущий столбец)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> four</span><span
class="token token punctuation">,</span><span> unique1 </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> tenk1
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> four </span><span
class="token token operator">BETWEEN</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">1</span><span> </span><span class="token token
operator">AND</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">3</span><span> </span><span class="token token operator">AND</span><span> unique1
 </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">42</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>EXPLAIN ANALYZE вывод:</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>Index Only Scan using tenk1_four_unique1_idx on tenk1
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">  (cost=0.29..6.90 rows=1 width=8)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  (actual time=0.006..0.007 rows=1 loops=1)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Index Cond: ((four &gt;= 1) AND (four &lt;= 3) AND (unique1 = 42))
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Index Searches: 3
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Buffers: shared hit=7
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Интерпретация:</strong></p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><code>Index Searches: 3</code> — критический метрик, указывающий на skip
scan</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Три отдельных поиска в индексе:</p>
<ol class="marker:text-quiet list-decimal">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><code>four = 1 AND unique1 = 42</code> (прочитано одно значение листовой
страницы)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><code>four = 2 AND unique1 = 42</code> (прочитано одно значение листовой
страницы)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><code>four = 3 AND unique1 = 42</code> (прочитано одно значение листовой
страницы)</p>
</li>
</ol>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Каждый поиск читает один или несколько листовых страниц, <strong>пропускает
все остальные листовые страницы</strong></p>
</li>
</ul>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">D. Представление в EXPLAIN: где появляется skip scan</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan не всегда явно обозначен как отдельный узел плана, потому что это
оптимизация <strong>внутри</strong> Index Scan узла:<span class="inline-flex" aria-label="How to Use Skip Scans in PostgreSQL 18 | Better Stack Community"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://betterstack.com/community/guides/databases/skip-scans-postgres/"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">betterstack</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Вариант 1: Явное обозначение (редко)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">Seq Scan
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span>  </span><span class="token token operator">-</span><span class="token token operator">&gt;</span><span> Custom Scan </span><span class="token
 token punctuation">(</span><span>SkipScan</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Вариант 2: Регулярный Index
Scan с метрикой Index Searches (обычно)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Scan </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">using</span><span> idx_name
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Searches: N
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Вариант 3: Bitmap Index Scan
с множественными поисками</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>Bitmap </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Scan
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">on</span><span> idx_name
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Searches: N
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Ключевой индикатор:</strong> Метрика <code>Index Searches: N</code>
где N &gt; 1 показывает, что skip scan был применён. Это единственный надежный способ диагностировать skip scan в EXPLAIN выводе.<span class="inline-flex"
aria-label="PostgreSQL 18 Enhanced EXPLAIN with Automatic Buffers" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow
noopener"><a rel="noopener" class="inline" target="_blank" href="https://neon.com/postgresql/postgresql-18/enhanced-explain"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">neon</span></span></span></a></span>​</span></p>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">E. Внутренние механизмы проб (probes)</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Документация PostgreSQL определяет "probe" как малый направленный поиск внутри
 B-tree:<span class="inline-flex" aria-label="PostgreSQL 18: B-Tree Skip Scans for Multicolumn Indexes - LinkedIn" data-state="closed"><span class="citation-nbsp"></span><span
 class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.linkedin.com/posts/mikhailfishzon_postgresql-databaseperformance-dataengineering-activity-7389038151509557248-vsIy"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">linkedin</span></span></span></a></span>​</span></p>
<ol class="marker:text-quiet list-decimal">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Позиционирование</strong>: Для каждого distinct значения пропущенного
столбца PostgreSQL конструирует полное составное условие. Например, если пропущенный столбец = status, а остальные условия = (category='shoes', date&gt;2025-01-01), то для
каждого distinct status значения (active, pending, shipped) создаётся зонд:</p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">(status='active', category='shoes', date&gt;2025-01-01)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">(status='pending', category='shoes', date&gt;2025-01-01)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">(status='shipped', category='shoes', date&gt;2025-01-01)</p>
</li>
</ul>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Навигация</strong>: Каждый зонд использует  Multicolumn Indexes -
LinkedIn" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.linkedin.com/posts/mikhailfishzon_postgresql-databaseperformance-dataengineering-activity-7389038151509557248-vsIy"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">linkedin</span></span></span></a></span>​</span></p>
</li>
</ol>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">II. Когда планировщик выбирает Skip Scan vs Full Table Scan</h2>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">A. Cost-based decision model</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">PostgreSQL не может быть принуждён использовать skip scan — решение принимает
автоматический планировщик на основе оценки стоимости.<span class="inline-flex" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://neon.com/postgresql/postgresql-18/skip-scan-btree"><span class="relative -mt-px
select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">neon</span><span class="ml-xs -mt-px mr-px inline-block
align-middle"><span class="opacity-50">+2</span></span></span></span></a></span>​</span></p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Планировщик сравнивает примерные затраты:</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>Cost(Sequential Scan) = (table_pages × seq_page_cost) + (rows ×
cpu_tuple_cost)
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">Cost(Index Scan) = (index_pages × random_page_cost) +
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                   (index_searches × B-tree_navigation_cost) +
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                   (heap_fetches × random_page_cost)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Cost(Skip Scan) = (skipped_columns_distinct_values × probe_cost) +
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                  (relevant_index_pages × page_access_cost) +
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">                  (heap_fetches × random_page_cost)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Планировщик выбирает минимальную оценённую стоимость. Skip scan выигрывает,
когда:</p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Количество distinct значений в пропущенном столбце мало</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Таблица достаточно большая, что sequential scan был бы дорогим</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Условия на более поздних столбцах достаточно селективны<span
class="inline-flex" aria-label="How to Use Skip Scans in PostgreSQL 18 | Better Stack Community" data-state="closed"><span class="citation-nbsp"></span><span class="citation
inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://betterstack.com/community/guides/databases/skip-scans-postgres/"><span
class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">betterstack</span></span></span></a></span>​</span></p>
</li>
</ul>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">B. Критические факторы: кардинальность пропущенного столбца</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Оптимальное количество distinct значений для skip scan:</strong></p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>1-5 значений</strong>: Excellent — skip scan почти наверняка будет
выбран</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Пример: статус с 3 значениями (active, pending, inactive)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_status_date </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> order_date</span><span class="token token punctuation">)</span><span class="token token
 punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> order_date </span><span class="token token operator">&gt;</span><span>
</span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan
выполнит 3 целевых поиска</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>5-20 значений</strong>: Good — вероятен skip scan в зависимости от
размера таблицы</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Пример: регион с 10 значениями</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_sales_region_date </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> sales</span><span class="token token punctuation">(</span><span>region</span><span class="token token
punctuation">,</span><span> sale_date</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>20-100 значений</strong>: Marginal — skip scan может быть выбран для
больших таблиц</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">CREATE</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_events_type_timestamp </span><span
 class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ON</span><span> events</span><span class="token token
punctuation">(</span><span>event_type</span><span class="token token punctuation">,</span><span> ts</span><span class="token token punctuation">)</span><span class="token
token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token punctuation">(</span><span class="token token operator">*</span><span class="token
token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> events </span><span class="token
token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> ts </span><span class="token token operator">&gt;</span><span> </span><span class="token
token" style="color: rgb(197, 200, 198);">now</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span> </span><span
class="token token operator">-</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span> </span><span
class="token token" style="color: rgb(181, 189, 104);">'7 days'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Если event_type
имеет ~50 значений и таблица содержит миллиарды строк</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>100+ значений</strong>: Poor — skip scan обычно не будет
использован</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Пример: user_id с 1M значений - skip scan неэффективен</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_logs_user_date </span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">ON</span><span> logs</span><span class="token token punctuation">(</span><span>user_id</span><span class="token token punctuation">,</span><span>
created_at</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Планировщик
предпочтёт sequential scan или index_only_scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
</li>
</ul>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Почему кардинальность критична:</strong><span class="inline-flex"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://xata.io/blog/going-down-the-rabbit-hole-of-postgres-18-features"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">xata</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span
class="opacity-50">+2</span></span></span></span></a></span>​</span></p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan имеет фиксированные издержки на каждый probe:</p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Навигация по B-tree (от корня к листу)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Позиционирование в индексе</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Начало нового поиска</p>
</li>
</ul>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Если пропущенный столбец имеет 1000 distinct значений, эти издержки
повторяются 1000 раз. При этом полное сканирование индекса прочитает данные один раз последовательно, что часто быстрее.<span class="inline-flex" aria-label="PostgreSQL 18
B-tree Skip Scan for Better Queries" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener"
class="inline" target="_blank" href="https://neon.com/postgresql/postgresql-18/skip-scan-btree"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans
text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group
min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">neon</span></span></span></a></span>​</span></p>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">C. Размер таблицы и эффективность кеша</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Планировщик учитывает параметр <code>effective_cache_size</code> при принятии
решений:<span class="inline-flex" aria-label="Documentation: 18: 19.7. Query Planning" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://www.postgresql.org/docs/current/runtime-config-query.html"><span class="relative -mt-px
select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">postgresql</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>-- Если таблица ПОЛНОСТЬЮ помещается в shared_buffers:
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">-- Sequential scan может быть оптимален даже с хорошим индексом
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">-- Если таблица намного больше доступной памяти:
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">-- Skip scan становится очень привлекательным, потому что:
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">-- - Читает только релевантные страницы индекса
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">-- - Пропускает большие секции индекса
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">-- - Кеширует горячие данные
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Практический пример:</strong><span class="inline-flex"
aria-label="PostgreSQL 18 New Features You Should Not Miss" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a
rel="noopener" class="inline" target="_blank" href="https://genexdbs.com/postgresql-18-new-features-you-should-not-miss/"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">genexdbs</span></span></span></a></span>​</span></p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">PostgreSQL 17: Seq Scan, 152 секунды</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">PostgreSQL 18: Skip Scan, 51 секунд</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Улучшение: 3x</strong> (для таблицы с миллионами строк)</p>
</li>
</ul>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">D. Селективность условий на поздних столбцах</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan требует полезных условий на столбцах <strong>после</strong>
пропущенного столбца:<span class="inline-flex" aria-label="Documentation: 18: 11.3. Multicolumn Indexes" data-state="closed"><span class="citation-nbsp"></span><span
class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://www.postgresql.org/docs/current/indexes-multicolumn.html"><span
class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">postgresql</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Пример 1: ХОРОШИЙ кандидат для skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс: (status,
customer_id)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> customer_id
</span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">42</span><span>  </span><span class="token token"
style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Equality на поздний столбец = GOOD</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">status</span><span> </span><span class="token token operator">IN</span><span> </span><span class="token token punctuation">(</span><span class="token
token" style="color: rgb(181, 189, 104);">'pending'</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'processing'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Пример 2: ПЛОХОЙ
кандидат</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс:
(status)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span> </span><span class="token token operator">&gt;</span><span> </span><span
class="token token" style="color: rgb(181, 189, 104);">'pending'</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color:
rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Нет полезного условия на поздний столбец</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Планировщик,
вероятно, выберет seq scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Пример 3:
ОПТИМАЛЬНЫЙ</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс: (status,
order_date)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token punctuation">(</span><span class="token token operator">*</span><span class="token
token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> order_date
</span><span class="token token operator">&gt;=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span>  </span><span
class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Range на поздний столбец = EXCELLENT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">status</span><span> </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'active'</span><span class="token token punctuation">;</span><span>           </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit;
font-style: italic;">-- Точное совпадение на пропущенный</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">E. Случаи, когда планировщик НЕ выбирает skip scan</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Даже с низкой кардинальностью пропущенного столбца:</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Случай 1: Результат покрывает большой процент таблицы</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">status</span><span> </span><span class="token token operator">IN</span><span> </span><span class="token token punctuation">(</span><span class="token token"
style="color: rgb(181, 189, 104);">'active'</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'pending'</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Если это 60%
таблицы, sequential scan быстрее, чем skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Случай 2: Индекс на малой
таблице</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">status</span><span> </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'active'</span><span>
 </span><span class="token token operator">AND</span><span> id </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(222,
 147, 95);">42</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Таблица с 1000
строк: seq scan почти всегда быстрее</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Случай 3: Неправильный
порядок столбцов в условиях</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>category</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token punctuation">)</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span> </span><span class="token token operator">=</span><span> </span><span
class="token token" style="color: rgb(181, 189, 104);">'active'</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color:
rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- status идёт вторым в индексе</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan не
применяется, потому что нет условия на category</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Случай 4: Неселективное
условие на позднем столбце</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_products </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">ON</span><span> products</span><span class="token token punctuation">(</span><span>category</span><span class="token token punctuation">,</span><span>
in_stock</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> products
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> in_stock </span><span
class="token token operator">=</span><span> </span><span class="token token boolean">true</span><span class="token token punctuation">;</span><span>  </span><span class="token
 token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 99% таблицы имеет in_stock=true</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan + range
 scan будет очень дорогим</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">III. Оптимизация структуры индексов для Skip Scan</h2>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">A. Принципы проектирования индексов для skip scan</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Правило 1: Низкая кардинальность впереди
(contra-intuitive)</strong></p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Исторически, рекомендовалось помещать высокую кардинальность впереди для
лучшей селективности. Со skip scan это изменилось:<span class="inline-flex" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow
noopener"><a rel="noopener" class="inline" target="_blank" href="https://www.pgedge.com/blog/postgres-18-skip-scan-breaking-free-from-the-left-most-index-limitation"><span
class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">pgedge</span><span class="ml-xs -mt-px mr-px inline-block
align-middle"><span class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- СТАРАЯ РЕКОМЕНДАЦИЯ (ещё актуальна для обычных индексов)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_v1 </span><span class="token token" style="color: rgb(178, 148, 187);
 font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>customer_id</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token punctuation">)</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- customer_id имеет
 высокую кардинальность</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- НОВАЯ РЕКОМЕНДАЦИЯ (если
часто запрашиваем по status)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_v2 </span><span class="token token" style="color: rgb(178, 148, 187);
 font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">status</span><span class="token token punctuation">,</span><span> customer_id</span><span class="token token punctuation">,</span><span> </span><span class="token
token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- status имеет
низкую кардинальность (3-5 значений)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Теперь skip scan
может быть использован для запросов без status</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- ГИБРИДНОЕ РЕШЕНИЕ (если нужны
 ОБА паттерна)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_status_date </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">date</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_customer_date </span><span class="token token" style="color: rgb(178,
 148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>customer_id</span><span class="token token
punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token
punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Отдельные индексы
 для разных паттернов запросов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Правило 2: Равенство перед range</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Индекс с равенством, а затем range</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_events_type_time </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> events</span><span class="token token punctuation">(</span><span>event_type</span><span class="token token
punctuation">,</span><span> event_time </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span class="token token
punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос 1: Skip scan отлично
работает</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> events
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> event_time
</span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token
punctuation">(</span><span class="token token punctuation">)</span><span> </span><span class="token token operator">-</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'7 days'</span><span
class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan: 15
probes (15 distinct event_types)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос 2: Даже лучше с явным
условием</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> events
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> event_type
</span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'login'</span><span> </span><span class="token
token operator">AND</span><span> event_time </span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(197, 200,
198);">now</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span> </span><span class="token token operator">-</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'7 days'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Обычный индексный
 скан без skip scan (быстрее)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Правило 3: Учитывайте реальные паттерны запросов</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Анализ реальных запросов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос A (40%
запросов): SELECT * FROM orders WHERE date &gt; ?</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос B (35%
запросов): SELECT * FROM orders WHERE status = ? AND date &gt; ?</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос C (25%
запросов): SELECT * FROM orders WHERE customer_id = ? AND date &gt; ?</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- ОПТИМАЛЬНАЯ
стратегия:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_date </span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
 bolder;">date</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color:
rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Для запроса A</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_status_date </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">date</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color: rgb(150,
 152, 150); font-family: inherit; font-style: italic;">-- Для B (skip scan)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_customer_date </span><span class="token token" style="color: rgb(178,
 148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>customer_id</span><span class="token token
punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token
punctuation">)</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style:
 italic;">-- Для C</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- АЛЬТЕРНАТИВА: один индекс
может пожертвовать performance для B</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_status_customer_date </span><span class="token token" style="color:
rgb(178, 148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">status</span><span class="token token punctuation">,</span><span> customer_id</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">date</span><span class="token token punctuation">)</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan для B,
обычный scan для C</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">B. Использование INCLUDE столбцов</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Index-only scans возможны с INCLUDE столбцами, что улучшает performance skip
scan:<span class="inline-flex" aria-label="Documentation: 18: 11.3. Multicolumn Indexes" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://www.postgresql.org/docs/current/indexes-multicolumn.html"><span class="relative -mt-px
select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">postgresql</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Индекс с INCLUDE (листовые страницы содержат all данные)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_skip_scan </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span class="token token
 punctuation">,</span><span>           </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Low cardinality,
используется для skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    order_date</span><span class="token token punctuation">,</span><span>       </span><span class="token token" style="color:
rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Range/equality</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    INCLUDE </span><span class="token token punctuation">(</span><span>customer_id</span><span class="token token
punctuation">,</span><span> amount</span><span class="token token punctuation">,</span><span> product_id</span><span class="token token punctuation">)</span><span>
</span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Данные для index-only scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос может быть обслужен
ТОЛЬКО из индекса</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
customer_id</span><span class="token token punctuation">,</span><span> amount </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> order_date
</span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Index Only Scan
(не требует heap fetches)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Index Searches: 5
 (для 5 distinct status значений)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">C. Partial indexes для дополнительной оптимизации</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Комбинировать skip scan с partial indexes для дальнейшей оптимизации:</p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Partial index только для активных заказов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_active </span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
 bolder;">status</span><span class="token token punctuation">,</span><span> order_date</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span> </span><span class="token token operator">IN</span><span> </span><span
class="token token punctuation">(</span><span class="token token" style="color: rgb(181, 189, 104);">'pending'</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(181, 189, 104);">'processing'</span><span class="token token punctuation">)</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос теперь использует
меньший индекс</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span> </span><span class="token token operator">IN</span><span> </span><span
class="token token punctuation">(</span><span class="token token" style="color: rgb(181, 189, 104);">'pending'</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(181, 189, 104);">'processing'</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> order_date </span><span class="token token
operator">&gt;</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan с
меньшим количеством leaf pages = быстрее</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">D. Порядок сортировки в индексе</h2>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- DESC порядок для частых диапазонных запросов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_events_type_time_desc </span><span class="token token" style="color:
rgb(178, 148, 187); font-weight: bolder;">ON</span><span> events</span><span class="token token punctuation">(</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    event_type</span><span class="token token punctuation">,</span><span>      </span><span class="token token" style="color:
rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan по типам событий</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    event_time </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span>
</span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Сортировка в обратном порядке</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос получает упорядоченные
 результаты из индекса</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> events
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> event_time
</span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token
punctuation">(</span><span class="token token punctuation">)</span><span> </span><span class="token token operator">-</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'7 days'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ORDER</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> event_time </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">DESC</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">LIMIT</span><span> </span><span
class="token token" style="color: rgb(222, 147, 95);">100</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- EXPLAIN
показывает:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Index Only Scan
(уже отсортирован)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Index Searches:
25 (для 25 distinct event_types)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">IV. Влияние Skip Scan на производительность аналитических запросов</h2>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">A. Типичные аналитические паттерны, выигрывающие от skip scan</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Паттерн 1: Time-series аналитика с категориями</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Таблица: 500 млн строк временных рядов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Столбцы:
sensor_id (1000 unique), metric_type (5 unique), </span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">--
timestamp, value</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_metrics_type_time </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">ON</span><span> metrics</span><span class="token token punctuation">(</span><span>metric_type</span><span class="token token punctuation">,</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">timestamp</span><span> </span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">DESC</span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Запрос: Получить последние 7
дней для всех метрик типов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PostgreSQL 17:
Seq Scan 5-8 секунд</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PostgreSQL 18 с
skip scan: 0.5-1.2 секунды (5-8x improvement)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> metric_type</span><span
class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token
punctuation">(</span><span class="token token operator">*</span><span class="token token punctuation">)</span><span class="token token punctuation">,</span><span> </span><span
 class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">value</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> metrics
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">timestamp</span><span> </span><span class="token token operator">&gt;</span><span> </span><span
class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span>
</span><span class="token token operator">-</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span>
</span><span class="token token" style="color: rgb(181, 189, 104);">'7 days'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> metric_type</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span class="token token"
 style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span> показал:
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Only Scan
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">using</span><span> idx_metrics_type_time
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Searches:
</span><span class="token token" style="color: rgb(222, 147, 95);">5</span><span>  </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit;
font-style: italic;">-- Пять проб, по одной на каждый metric_type</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  Buffers: shared hit</span><span class="token token operator">=</span><span class="token token" style="color: rgb(222, 147,
95);">2340</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">read</span><span class="token token operator">=</span><span
class="token token" style="color: rgb(222, 147, 95);">156</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  Execution </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Time</span><span>:
</span><span class="token token" style="color: rgb(222, 147, 95);">0.847</span><span> ms
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Паттерн 2: Отчётность по регионам/категориям</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Таблица: 100 млн заказов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс: (region,
created_at, amount)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_orders_region_date </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">ON</span><span> orders</span><span class="token token punctuation">(</span><span>region</span><span class="token token punctuation">,</span><span>
created_at </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span class="token token punctuation">)</span><span class="token
 token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Получить статистику по всем
регионам за последний день</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PostgreSQL 17:
2.3 секунды (seq scan)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PostgreSQL 18:
0.3 секунды (skip scan with 15 regions)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    region</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token
punctuation">(</span><span class="token token operator">*</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">as</span><span> order_count</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">SUM</span><span class="token token
punctuation">(</span><span>amount</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">as</span><span> total_amount</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token
punctuation">(</span><span>amount</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">as</span><span> avg_amount
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> orders
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> created_at
</span><span class="token token operator">&gt;=</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CURRENT_DATE</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> region</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span class="token token"
 style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span>:
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Only Scan
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">using</span><span> idx_orders_region_date
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Index</span><span> Searches:
</span><span class="token token" style="color: rgb(222, 147, 95);">15</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  Planning </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Time</span><span>:
</span><span class="token token" style="color: rgb(222, 147, 95);">0.234</span><span> ms
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  Execution </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">Time</span><span>:
</span><span class="token token" style="color: rgb(222, 147, 95);">301.543</span><span> ms </span><span class="token token punctuation">(</span><span class="token token"
style="color: rgb(222, 147, 95);">40</span><span class="token token operator">%</span><span> improvement</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Паттерн 3: DISTINCT запросы на поздних столбцах</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Получить все уникальные значения столбца за период</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс: (status,
user_id, timestamp)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">DISTINCT</span><span> user_id
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> events
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">status</span><span> </span><span class="token token operator">=</span><span> </span><span
class="token token" style="color: rgb(181, 189, 104);">'completed'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">timestamp</span><span> </span><span class="token token operator">&gt;=</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'2024-01-01'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Skip scan: Один probe для
status='completed', </span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">--            затем
скан unique user_id значений</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 10-100x быстрее
чем seq scan на больших таблицах</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">B. Бенчмарк-результаты (из реальных реализаций)</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Бенчмарк 1: PostgreSQL официальный тест</strong><span
class="inline-flex" aria-label="PostgreSQL 18 New Features You Should Not Miss" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://genexdbs.com/postgresql-18-new-features-you-should-not-miss/"><span class="relative
-mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">genexdbs</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>Query: SELECT * FROM large_table WHERE indexed_column = constant
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">Table size: 100 млн строк
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Index leading column cardinality: 4
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">PostgreSQL 17 (Seq Scan):     152 seconds
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">PostgreSQL 18 (Skip Scan):     51 seconds
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Improvement:                  3x faster (66% reduction)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Бенчмарк 2: Xata.io реальная нагрузка</strong><span
class="inline-flex" aria-label="Going down the rabbit hole of Postgres 18 features" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://xata.io/blog/going-down-the-rabbit-hole-of-postgres-18-features"><span class="relative
-mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">xata</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>Time-series queries with low-cardinality prefix columns
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">Query result set size variations:
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Small result (0.01% of table):
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG17: 85ms (seq scan)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG18: 12ms (skip scan)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  Improvement: 7x
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Medium result (1% of table):
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG17: 340ms
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG18: 95ms
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  Improvement: 3.5x
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">Large result (20% of table):
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG17: 2100ms (seq scan preferred)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  PG18: 1200ms (skip scan still wins)
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">  Improvement: 1.75x
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Бенчмарк 3: Planetscale PostgreSQL 17 vs 18</strong><span
class="inline-flex" aria-label="Benchmarking Postgres 17 vs 18" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a
 rel="noopener" class="inline" target="_blank" href="https://planetscale.com/blog/benchmarking-postgres-17-vs-18"><span class="relative -mt-px select-none whitespace-nowrap
-top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs
rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">planetscale</span></span></span></a></span>​</span></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">text</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span>Mixed OLAP workload with various index strategies:
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">- Skip scan improved 40-70% for eligible queries
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">- No regression for non-skip-scan queries
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;">- Storage efficiency improved due to better index utilization
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">C. Предположение неправильного плана и способы исправления</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Сценарий: Skip scan не был использован, но должен был</strong></p>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Проблема: Запрос использует seq scan вместо skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> category</span><span
class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token
punctuation">(</span><span class="token token operator">*</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> products
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> last_update
</span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'2024-01-01'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> category</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- QUERY PLAN:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Seq Scan on
products (cost=0.00..1000000.00 rows=1000000)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">--   Filter:
(last_update &gt; '2024-01-01')</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Решение 1: Проверить,
существует ли индекс</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> pg_indexes </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> tablename </span><span class="token token operator">=</span><span> </span><span
class="token token" style="color: rgb(181, 189, 104);">'products'</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Если индекса нет,
 создать:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_products_category_date </span><span class="token token" style="color:
rgb(178, 148, 187); font-weight: bolder;">ON</span><span> products</span><span class="token token punctuation">(</span><span>category</span><span class="token token
punctuation">,</span><span> last_update </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span class="token token
punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Решение 2: Обновить
статистику (может быть неточной)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span> products</span><span
 class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Решение 3: Увеличить
default_statistics_target</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ALTER</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">TABLE</span><span> products </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">ALTER</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">COLUMN</span><span> category </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SET</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">STATISTICS</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">500</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span> products</span><span
 class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Решение 4: Проверить planner
cost parameters</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SHOW</span><span>
random_page_cost</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit;
font-style: italic;">-- Должен быть 1.1 для SSD, 4.0 для HDD</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SHOW</span><span>
effective_cache_size</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit;
font-style: italic;">-- Должен быть ~75% RAM</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Решение 5: Принудительное
тестирование (только для диагностики)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SET</span><span> enable_seqscan
</span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">OFF</span><span class="token
token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span> </span><span class="token token punctuation">.</span><span class="token token
punctuation">.</span><span class="token token punctuation">.</span><span> </span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>RESET enable_seqscan</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">D. Временные ряды и аналитические нагрузки</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan особенно мощен для временных рядов, где:</p>
<ul class="marker:text-quiet list-disc">
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Низкая кардинальность на "категории" (sensor_type, region, account_id)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Высокая кардинальность на временных измерениях (timestamp, sequence)</p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Частые запросы: "Последние N дней для всех категорий"<span class="inline-flex"
 data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://devtechtools.org/en/blog/postgresql-brin-index-tuning-time-series-scale"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">devtechtools</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span
class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
</li>
</ul>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Оптимальная структура для временных рядов</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">TABLE</span><span> timeseries </span><span class="token token punctuation">(</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    id BIGSERIAL </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">PRIMARY</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">KEY</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    sensor_id </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INT</span><span
class="token token punctuation">,</span><span>           </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">--
100s-1000s unique</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    metric_type </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">VARCHAR</span><span
class="token token punctuation">(</span><span class="token token" style="color: rgb(222, 147, 95);">50</span><span class="token token punctuation">)</span><span class="token
token punctuation">,</span><span> </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 5-20 unique (PERFECT для
skip scan)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">timestamp</span><span>
TIMESTAMPTZ</span><span class="token token punctuation">,</span><span>   </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style:
italic;">-- Billions of distinct values</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">value</span><span> FLOAT8
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Индекс для skip
scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INDEX</span><span> idx_ts_metric_time </span><span class="token token" style="color: rgb(178, 148,
187); font-weight: bolder;">ON</span><span> timeseries</span><span class="token token punctuation">(</span><span>metric_type</span><span class="token token
punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">timestamp</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    INCLUDE </span><span class="token token punctuation">(</span><span>sensor_id</span><span class="token token
punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">value</span><span class="token token
punctuation">)</span><span class="token token punctuation">;</span><span>  </span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style:
 italic;">-- INCLUDE для index-only scans</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Типичный аналитический запрос
 (выигрывает от skip scan)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    metric_type</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    DATE_TRUNC</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(181, 189,
104);">'day'</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">timestamp</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">as</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">day</span><span class="token token
punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">COUNT</span><span class="token token
punctuation">(</span><span class="token token operator">*</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">as</span><span> count</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token
punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">value</span><span class="token token punctuation">)</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> avg_val</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">MIN</span><span class="token token
punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">value</span><span class="token token punctuation">)</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> min_val</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">MAX</span><span class="token token
punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">value</span><span class="token token punctuation">)</span><span>
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> max_val
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> timeseries
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">timestamp</span><span> </span><span class="token token operator">&gt;</span><span> </span><span
class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token punctuation">(</span><span class="token token punctuation">)</span><span>
</span><span class="token token operator">-</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">interval</span><span>
</span><span class="token token" style="color: rgb(181, 189, 104);">'30 days'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> metric_type</span><span class="token token punctuation">,</span><span> </span><span
 class="token token" style="color: rgb(222, 147, 95);">1</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Результаты:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PG17: 45 seconds
(Seq Scan всей таблицы)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PG18: 4.2 seconds
 (Skip Scan: 1 probe per metric_type)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">V. Диагностические инструменты и мониторинг</h2>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">A. Проверка использования skip scan</h2>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- 1. Получить EXPLAIN ANALYZE с полными деталями</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">EXPLAIN</span><span> </span><span
class="token token punctuation">(</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ANALYZE</span><span class="token token
punctuation">,</span><span> BUFFERS</span><span class="token token punctuation">,</span><span> VERBOSE</span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> your_table </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> your_conditions</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Ищите: "Index Searches: N"
где N &gt; 1</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Это единственный
надежный индикатор skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 2. Сравнить различные версии
плана</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- PostgreSQL 17 vs
18 для одного запроса</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Смотрите:
снижение buffers read, улучшение execution time</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 3. Проверить индексы на
таблице</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> indexname</span><span
 class="token token punctuation">,</span><span> indexdef
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> pg_indexes
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> tablename </span><span
 class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'your_table'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ORDER</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> indexname</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- 4. Проверить статистику
столбцов (кардинальность)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> attname</span><span
class="token token punctuation">,</span><span> n_distinct</span><span class="token token punctuation">,</span><span> n_distinct_inherited
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> pg_stats
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> tablename </span><span
 class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'your_table'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> attname </span><span class="token token operator">IN</span><span>
</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(181, 189, 104);">'column1'</span><span class="token token
punctuation">,</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'column2'</span><span class="token token punctuation">)</span><span
class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Ищите: низкие
n_distinct значения на leading columns</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">B. Мониторинг skip scan в production</h2>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Создать представление для отслеживания индексов, кандидатов на skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">VIEW</span><span> v_skip_scan_candidates </span><span class="token token" style="color: rgb(178,
148, 187); font-weight: bolder;">AS</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    schemaname</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    tablename</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexdef</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_blks_hit</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_blks_read</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_tup_read</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_tup_fetch</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CASE</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>        </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHEN</span><span> idx_blks_read
</span><span class="token token operator">&gt;</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">0</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>        </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">THEN</span><span> </span><span
class="token token" style="color: rgb(197, 200, 198);">ROUND</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(222, 147,
95);">100.0</span><span> </span><span class="token token operator">*</span><span> idx_blks_hit </span><span class="token token operator">/</span><span> </span><span
class="token token punctuation">(</span><span>idx_blks_hit </span><span class="token token operator">+</span><span> idx_blks_read</span><span class="token token
punctuation">)</span><span class="token token punctuation">,</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">2</span><span class="token token
punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>        </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ELSE</span><span> </span><span
class="token token" style="color: rgb(222, 147, 95);">100.0</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">END</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> cache_hit_ratio
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> pg_stat_user_indexes
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> indexrelname
</span><span class="token token operator">LIKE</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'%_idx'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> idx_tup_read </span><span class="token token
operator">&gt;</span><span> </span><span class="token token" style="color: rgb(222, 147, 95);">0</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ORDER</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> idx_blks_read </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">DESC</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Использование</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span> </span><span
class="token token operator">*</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> v_skip_scan_candidates
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">LIMIT</span><span> </span><span class="token token" style="color: rgb(222, 147,
95);">20</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Для конкретного индекса,
проверить если он кандидат для skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    array_agg</span><span class="token token punctuation">(</span><span>attname</span><span class="token token
punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> </span><span class="token token"
style="color: rgb(178, 148, 187); font-weight: bolder;">columns</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    array_agg</span><span class="token token punctuation">(</span><span>n_distinct</span><span class="token token
punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> cardinalities
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> pg_stat_user_indexes i
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">JOIN</span><span> pg_index idx
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ON</span><span> i</span><span class="token token punctuation">.</span><span>indexrelid
 </span><span class="token token operator">=</span><span> idx</span><span class="token token punctuation">.</span><span>indexrelid
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">JOIN</span><span> pg_attribute a
</span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ON</span><span> a</span><span class="token token punctuation">.</span><span>attrelid
</span><span class="token token operator">=</span><span> idx</span><span class="token token punctuation">.</span><span>indrelid
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>                      </span><span class="token token operator">AND</span><span> a</span><span class="token token
punctuation">.</span><span>attnum </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">ANY</span><span class="token token punctuation">(</span><span>idx</span><span class="token token punctuation">.</span><span>indkey</span><span class="token token
punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">JOIN</span><span> pg_stats s </span><span
 class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ON</span><span> s</span><span class="token token punctuation">.</span><span>tablename </span><span
 class="token token operator">=</span><span> i</span><span class="token token punctuation">.</span><span>relname
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>                 </span><span class="token token operator">AND</span><span> s</span><span class="token token
punctuation">.</span><span>attname </span><span class="token token operator">=</span><span> a</span><span class="token token punctuation">.</span><span>attname
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> i</span><span
class="token token punctuation">.</span><span>relname </span><span class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189,
104);">'your_table'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> i</span><span class="token token punctuation">.</span><span>indexname</span><span
class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Анализировать
результаты:</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Если первые 1-2
столбца имеют n_distinct &lt; 100</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- И остальные
столбцы имеют n_distinct &gt; 10000</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- --&gt; Хороший
кандидат для skip scan</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">C. Исторический анализ улучшений</h2>
<div class="w-full md:max-w-[90vw]"><pre class="not-prose w-full rounded font-mono text-sm font-extralight"><div class="codeWrapper text-light selection:text-super
selection:bg-super/10 my-md relative flex flex-col rounded-lg font-mono text-sm font-normal bg-subtler"><div class="translate-y-xs -translate-x-xs bottom-xl mb-xl flex h-0
items-start justify-end sm:sticky sm:top-xs"><div class="overflow-hidden rounded-full border-subtlest ring-subtlest divide-subtlest bg-base"><div class="border-subtlest
ring-subtlest divide-subtlest bg-subtler"><button data-testid="copy-code-button" aria-label="Copy code" type="button" class="focus-visible:bg-subtle hover:bg-subtle text-quiet
  hover:text-foreground dark:hover:bg-subtle font-sans focus:outline-none outline-none outline-transparent transition duration-300 ease-out select-none items-center relative
group/button font-semimedium justify-center text-center items-center rounded-full cursor-pointer active:scale-[0.97] active:duration-150 active:ease-outExpo origin-center
whitespace-nowrap inline-flex text-sm h-8 aspect-square" data-state="closed"><div class="flex items-center min-w-0 gap-two justify-center"><div class="flex shrink-0
items-center justify-center size-4"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-copy"></use></svg></div></div></button></div></div></div><div class="-mt-xl"><div><div data-testid="code-language-indicator" class="text-quiet bg-subtle
 py-xs px-sm inline-block rounded-br rounded-tl-lg text-xs font-thin">sql</div></div><div><span style="font-size: inherit; font-family: inherit; background: transparent;
color: rgb(197, 200, 198); border-radius: 3px; display: flex; line-height: 1.42857; overflow-x: auto; white-space: pre; --scrollbar-thumb: oklch(var(--foreground-color) /
0.15); --scrollbar-track: transparent; scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);"><code style="white-space: pre-wrap; font-size:
inherit; font-family: inherit; line-height: 1.66667; padding: 8px;"><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198);
background-color: transparent; flex-shrink: 0; padding: 8px; text-align: right; user-select: none;"><span class="token token" style="color: rgb(150, 152, 150); font-family:
inherit; font-style: italic;">-- Собирать метрики за время для отслеживания улучшений</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">CREATE</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">TABLE</span><span> index_metrics_history </span><span class="token token
punctuation">(</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    capture_date TIMESTAMPTZ </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">DEFAULT</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token punctuation">(</span><span class="token
token punctuation">)</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">VARCHAR</span><span
class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_scan </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BIGINT</span><span
class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_tup_read </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BIGINT</span><span
class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    idx_tup_fetch </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BIGINT</span><span
class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    heap_blks_hit </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BIGINT</span><span
class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    heap_blks_read </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BIGINT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token punctuation">)</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Ежедневная запись
метрик</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INSERT</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">INTO</span><span> index_metrics_history </span><span class="token token punctuation">(</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname</span><span class="token token punctuation">,</span><span> idx_scan</span><span class="token token
punctuation">,</span><span> idx_tup_read</span><span class="token token punctuation">,</span><span> idx_tup_fetch</span><span class="token token punctuation">,</span><span>
heap_blks_hit</span><span class="token token punctuation">,</span><span> heap_blks_read
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token punctuation">)</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname</span><span class="token token punctuation">,</span><span> idx_scan</span><span class="token token
punctuation">,</span><span> idx_tup_read</span><span class="token token punctuation">,</span><span> idx_tup_fetch</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    heap_blks_hit</span><span class="token token punctuation">,</span><span> heap_blks_read
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span>
pg_stat_user_indexes</span><span class="token token punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;">
</span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px; text-align:
right; user-select: none;"><span></span><span class="token token" style="color: rgb(150, 152, 150); font-family: inherit; font-style: italic;">-- Анализ тренда за
месяц</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">SELECT</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    indexname</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    date_trunc</span><span class="token token punctuation">(</span><span class="token token" style="color: rgb(181, 189,
104);">'day'</span><span class="token token punctuation">,</span><span> capture_date</span><span class="token token punctuation">)</span><span> </span><span class="token
token" style="color: rgb(178, 148, 187); font-weight: bolder;">as</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">day</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token
punctuation">(</span><span>idx_scan</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">as</span><span> avg_scans</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token
punctuation">(</span><span>idx_tup_read</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">as</span><span> avg_tuples_read</span><span class="token token punctuation">,</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>    </span><span class="token token" style="color: rgb(197, 200, 198);">AVG</span><span class="token token
punctuation">(</span><span>heap_blks_read</span><span class="token token punctuation">)</span><span> </span><span class="token token" style="color: rgb(178, 148, 187);
font-weight: bolder;">as</span><span> avg_heap_reads
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">FROM</span><span> index_metrics_history
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">WHERE</span><span> indexname </span><span
 class="token token operator">=</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'idx_orders_status_date'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span>  </span><span class="token token operator">AND</span><span> capture_date </span><span class="token token
operator">&gt;</span><span> </span><span class="token token" style="color: rgb(197, 200, 198);">now</span><span class="token token punctuation">(</span><span class="token
token punctuation">)</span><span> </span><span class="token token operator">-</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">interval</span><span> </span><span class="token token" style="color: rgb(181, 189, 104);">'30 days'</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">GROUP</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> indexname</span><span class="token token punctuation">,</span><span> </span><span
class="token token" style="color: rgb(222, 147, 95);">1</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"><span></span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">ORDER</span><span> </span><span
class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">BY</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight:
bolder;">day</span><span> </span><span class="token token" style="color: rgb(178, 148, 187); font-weight: bolder;">DESC</span><span class="token token
punctuation">;</span><span>
</span></span><span style="opacity: 1; font-size: inherit; line-height: 1.42857; color: rgb(197, 200, 198); background-color: transparent; flex-shrink: 0; padding: 8px;
text-align: right; user-select: none;"></span></code></span></div></div></div></pre></div>
<h2 class="mb-2 mt-4 font-display font-semimedium text-base first:mt-0">Выводы</h2>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Skip scan в PostgreSQL 18 — это трансформационная оптимизация, которая позine"
 rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://opensource-db.com/pg18-hacktober-31-days-of-new-features-skip-scan-on-multicolumn-b-tree-indexes/"><span class="relative -mt-px select-none whitespace-nowrap
-top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs
rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">opensource-db</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span
class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Диагностика</strong>: Метрика <code>Index Searches: N</code> в EXPLAIN
 ANALYZE указывает на применение skip scan.<span class="inline-flex" aria-label="PostgreSQL 18 Enhanced EXPLAIN with Automatic Buffers" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://neon.com/postgresql/postgresql-18/enhanced-explain"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">neon</span></span></span></a></span>​</span></p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Условия успеха</strong>: Низкая кардинальность пропущенного столбца
(3-20 значений оптимально), равенство/диапазоны на более поздних столбцах, достаточно большие таблицы.<span class="inline-flex" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://neon.com/postgresql/postgresql-18/skip-scan-btree"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">neon</span><span class="ml-xs -mt-px mr-px inline-block align-middle"><span class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Автоматизация</strong>: Планировщик автоматически выбирает skip scan
на основе cost-модели; нет необходимости в явной конфигурации.<span class="inline-flex" aria-label="Postgres 18: Skip Scan - Breaking Free from the Left-Most Index ..."
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.pgedge.com/blog/postgres-18-skip-scan-breaking-free-from-the-left-most-index-limitation"><span class="relative -mt-px select-none whitespace-nowrap -top-px
font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge
group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">pgedge</span></span></span></a></span>​</span></p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Производительность</strong>: 3-7x улучшения для аналитических запросов
 на аппендируемых таблицах; особенно эффективно для временных рядов.<span class="inline-flex" data-state="closed"><span class="citation-nbsp"></span><span class="citation
inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://genexdbs.com/postgresql-18-new-features-you-should-not-miss/"><span
class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">genexdbs</span><span class="ml-xs -mt-px mr-px inline-block
align-middle"><span class="opacity-50">+1</span></span></span></span></a></span>​</span></p>
</li>
<li class="py-0 my-0 prose-p:pt-0 prose-p:mb-2 prose-p:my-0 [&amp;&gt;p]:pt-0 [&amp;&gt;p]:mb-2 [&amp;&gt;p]:my-0">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Проектирование индексов</strong>: Новая рекомендация — помещать
низкокардинальные столбцы впереди, обратное исторической практике, для максимизации skip scan преимуществ.<span class="inline-flex" aria-label="Postgres 18: Skip Scan -
Breaking Free from the Left-Most Index ..." data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener"
class="inline" target="_blank" href="https://www.pgedge.com/blog/postgres-18-skip-scan-breaking-free-from-the-left-most-index-limitation"><span class="relative -mt-px
select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">pgedge</span></span></span></a></span>​</span></p>
</li>
</ol>
<hr class="bg-subtle h-px border-0" node="[object Object]">
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2"><strong>Источники:</strong></p>
<p class="my-2 [&amp;+p]:mt-4 [&amp;_strong:has(+br)]:inline-block [&amp;_strong:has(+br)]:pb-2">Xata.io, "Going Down the Rabbit Hole of PostgreSQL 18 Features", 2025.<span
class="inline-flex" aria-label="Going down the rabbit hole of Postgres 18 features" data-state="closed"><span class="citation-nbsp"></span><span class="citation inline"
rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank" href="https://xata.io/blog/going-down-the-rabbit-hole-of-postgres-18-features"><span class="relative
-mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug
px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest
divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">xata</span></span></span></a></span>​</span><br>
Opensource-DB, "Skip Scan on Multicolumn B-tree Indexes", 2025.<span class="inline-flex" aria-label="In Postgresql 17" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://opensource-db.com/pg18-hacktober-31-days-of-new-features-skip-scan-on-multicolumn-b-tree-indexes/"><span class="relative -mt-px select-none whitespace-nowrap
-top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs
rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">opensource-db</span></span></span></a></span>​</span><br>
Neon, "PostgreSQL 18 B-tree Skip Scan for Better Queries", 2025.<span class="inline-flex" aria-label="PostgreSQL 18 B-tree Skip Scan for Better Queries"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://neon.com/postgresql/postgresql-18/skip-scan-btree"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">neon</span></span></span></a></span>​</span><br>
GenexDBS, "PostgreSQL 18 New Features", 2026.<span class="inline-flex" aria-label="PostgreSQL 18 New Features You Should Not Miss" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://genexdbs.com/postgresql-18-new-features-you-should-not-miss/"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">genexdbs</span></span></span></a></span>​</span><br>
PgEdge, "Postgres 18: Skip Scan - Breaking Free from the Left-Most Index Limitation", 2025.<span class="inline-flex" aria-label="Postgres 18: Skip Scan - Breaking Free from
the Left-Most Index ..." data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline"
target="_blank" href="https://www.pgedge.com/blog/postgres-18-skip-scan-breaking-free-from-the-left-most-index-limitation"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">pgedge</span></span></span></a></span>​</span><br>
PostgreSQL Documentation, "Using EXPLAIN", 2025.<span class="inline-flex" aria-label="Documentation: 18: 14.1. Using EXPLAIN" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.postgresql.org/docs/current/using-explain.html"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">postgresql</span></span></span></a></span>​</span><br>
PostgreSQL Documentation, "Multicolumn Indexes", 2025.<span class="inline-flex" aria-label="Documentation: 18: 11.3. Multicolumn Indexes" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.postgresql.org/docs/current/indexes-multicolumn.html"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">postgresql</span></span></span></a></span>​</span><br>
LinkedIn, "PostgreSQL 18: B-Tree Skip Scans", 2025.<span class="inline-flex" aria-label="PostgreSQL 18: B-Tree Skip Scans for Multicolumn Indexes - LinkedIn"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://www.linkedin.com/posts/mikhailfishzon_postgresql-databaseperformance-dataengineering-activity-7389038151509557248-vsIy"><span class="relative -mt-px select-none
whitespace-nowrap -top-px font-sans text-base text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span
class="text-3xs rounded-badge group min-w-4 cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem]
[@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest
bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch] overflow-hidden">linkedin</span></span></span></a></span>​</span><br>
Better Stack, "How to Use Skip Scans in PostgreSQL 18", 2025.<span class="inline-flex" aria-label="How to Use Skip Scans in PostgreSQL 18 | Better Stack Community"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://betterstack.com/community/guides/databases/skip-scans-postgres/"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base
text-foreground selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4
cursor-pointer text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super
dark:[@media(hover:hover)]:hover:text-inverse [@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px
inline-block align-middle max-w-[25ch] overflow-hidden">betterstack</span></span></span></a></span>​</span><br>
PlanetScale, "Benchmarking Postgres 17 vs 18", 2025.<span class="inline-flex" aria-label="Benchmarking Postgres 17 vs 18" data-state="closed"><span
class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://planetscale.com/blog/benchmarking-postgres-17-vs-18"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">planetscale</span></span></span></a></span>​</span><br>
Neon, "PostgreSQL 18 Enhanced EXPLAIN with Automatic Buffers", 2025.<span class="inline-flex" aria-label="PostgreSQL 18 Enhanced EXPLAIN with Automatic Buffers"
data-state="closed"><span class="citation-nbsp"></span><span class="citation inline" rel="nofollow noopener"><a rel="noopener" class="inline" target="_blank"
href="https://neon.com/postgresql/postgresql-18/enhanced-explain"><span class="relative -mt-px select-none whitespace-nowrap -top-px font-sans text-base text-foreground
selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10 dark:selection:text-super"><span class="text-3xs rounded-badge group min-w-4 cursor-pointer
text-center align-middle font-mono tabular-nums py-[0.1875rem] leading-snug px-[0.3rem] [@media(hover:hover)]:hover:bg-super dark:[@media(hover:hover)]:hover:text-inverse
[@media(hover:hover)]:hover:text-white border-subtlest ring-subtlest divide-subtlest bg-subtle"><span class="relative -mt-px inline-block align-middle max-w-[25ch]
overflow-hidden">neon</span></span></span></a></span>​</span></p></div></div></div></div></div></div><div class="flex items-center justify-between"><div class="-ml-sm gap-xs
flex flex-shrink-0 items-center"><button aria-label="Share" data-state="closed" type="button" class="reset interactable select-none [-webkit-user-drag:none] outline-none
font-semimedium duration-300 ease-out font-sans text-center items-center justify-center leading-loose whitespace-nowrap data-[state=open]:text-foreground
data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo inline-flex rounded-full
aspect-square p-0 aspect-[9/8] hover:text-foreground hover:bg-subtle"><div class="relative flex items-center justify-center"><div style="opacity: 1; transition: opacity 150ms
150ms;" class="inline-flex"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use xlink:href="#pplx-icon-share-3"></use></svg></div><div style="opacity:
 0; transition: opacity 150ms;" class="absolute inset-0 flex items-center justify-center"></div></div></button><button data-state="closed" aria-label="Download"
aria-expanded="false" aria-haspopup="menu" type="button" class="reset interactable select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out
font-sans text-center items-center justify-center leading-loose whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm
cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo inline-flex rounded-full aspect-square p-0 hover:text-foreground hover:bg-subtle"><svg
 role="img" class="inline-flex fill-current" width="16" height="16"><use xlink:href="#pplx-icon-download"></use></svg></button><button aria-label="Copy" data-state="closed"
type="button" class="reset interactable select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out font-sans text-center items-center
justify-center leading-loose whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center
active:scale-[0.97] active:duration-150 active:ease-outExpo inline-flex rounded-full aspect-square p-0 aspect-[9/8] hover:text-foreground hover:bg-subtle"><div class="relative
 flex items-center justify-center"><div style="opacity: 1; transition: opacity 150ms 150ms;" class="inline-flex"><svg role="img" class="inline-flex fill-current" width="16"
height="16"><use xlink:href="#pplx-icon-copy"></use></svg></div><div style="opacity: 0; transition: opacity 150ms;" class="absolute inset-0 flex items-center
justify-center"></div></div></button><button data-state="closed" aria-label="Rewrite" aria-expanded="false" aria-haspopup="menu" type="button" class="reset interactable
select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out font-sans text-center items-center justify-center leading-loose whitespace-nowrap
data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo
inline-flex rounded-full aspect-square p-0 hover:text-foreground hover:bg-subtle"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-repeat"></use></svg></button><button type="button" class="reset interactable select-none [-webkit-user-drag:none] outline-none font-semimedium
duration-300 ease-out font-sans text-center items-center justify-center leading-loose whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle
text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo inline-flex rounded-full hover:text-foreground hover:bg-subtle
px-3 relative"><span style="opacity: 1; transition: opacity 150ms 150ms;" class="text-box-trim-both"><div class="gap-x-sm flex flex-row"><svg width="14" height="14" viewBox="0
 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="absolute opacity-0"><defs><clipPath id="clip-path-default"><path fill-rule="evenodd" clip-rule="evenodd"
d="M10.0635 0.704214C9.13824 0.253115 8.09868 0 7 0C3.13401 0 0 3.13401 0 7C0 10.866 3.13401 14 7 14C8.09868 14 9.13824 13.7469 10.0635 13.2958C8.19825 11.8312 7 9.55552 7 7C7
 4.44448 8.19825 2.16882 10.0635 0.704214Z" fill="#D9D9D9"></path></clipPath></defs></svg><svg width="12" height="12" viewBox="0 0 12 12" fill="none"
xmlns="http://www.w3.org/2000/svg" class="absolute opacity-0"><defs><clipPath id="clip-path-small"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.57242 0.57787C7.7928
0.20734 6.92062 0 6 0C2.68629 0 0 2.68629 0 6C0 9.31371 2.68629 12 6 12C6.92062 12 7.7928 11.7927 8.57242 11.4221C7.00228 10.1385 6 8.18628 6 6C6 3.81372 7.00228 1.86154
8.57242 0.57787Z" fill="#D9D9D9"></path></clipPath></defs></svg><div class="gap-xs relative flex shrink-0 items-center"><div class="ml-xs flex"><div style="clip-path:
url(&quot;#clip-path-default&quot;);" class="relative shrink-0 overflow-hidden rounded-full bg-subtle relative z-0 inline-flex shrink-0 -ml-[5px]"><div class="rounded-inherit
absolute inset-0 bg-white"></div><img class="relative block" alt="opensource-db.com favicon" width="14" height="14" style="width: 14px; height: 14px;"
src="https://www.google.com/s2/favicons?sz=128&amp;domain=opensource-db.com"><div class="rounded-inherit absolute inset-0 border border-[black]/10
dark:border-transparent"></div></div><div style="clip-path: url(&quot;#clip-path-default&quot;);" class="relative shrink-0 overflow-hidden rounded-full bg-subtle relative z-0
inline-flex shrink-0 -ml-[5px]"><div class="rounded-inherit absolute inset-0 bg-white"></div><img class="relative block" alt="neon.com favicon" width="14" height="14"
style="width: 14px; height: 14px;" src="https://www.google.com/s2/favicons?sz=128&amp;domain=neon.com"><div class="rounded-inherit absolute inset-0 border border-[black]/10
dark:border-transparent"></div></div><div class="relative shrink-0 overflow-hidden rounded-full bg-subtle relative z-0 inline-flex shrink-0 -ml-[5px]"><div
class="rounded-inherit absolute inset-0 bg-white"></div><img class="relative block" alt="pgedge.com favicon" width="14" height="14" style="width: 14px; height: 14px;"
src="https://www.google.com/s2/favicons?sz=128&amp;domain=pgedge.com"><div class="rounded-inherit absolute inset-0 border border-[black]/10
dark:border-transparent"></div></div></div></div><div class="truncate font-sans text-sm text-quiet  selection:bg-super/50 selection:text-foreground dark:selection:bg-super/10
dark:selection:text-super">43 sources</div></div></span><div style="opacity: 0; transition: opacity 150ms;" class="absolute inset-0 flex items-center
justify-center"></div></button></div><div class="gap-x-xs flex flex-shrink-0 items-center"><span><button aria-label="Research" data-state="closed" type="button" class="reset
interactable select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out font-sans text-center items-center justify-center leading-loose
whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97] active:duration-150
active:ease-outExpo inline-flex rounded-full aspect-square p-0 aspect-[9/8] hover:text-foreground hover:bg-subtle"><div class="relative flex items-center justify-center"><div
style="opacity: 1; transition: opacity 150ms 150ms;" class="inline-flex"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-cpu"></use></svg></div><div style="opacity: 0; transition: opacity 150ms;" class="absolute inset-0 flex items-center
justify-center"></div></div></button></span><span><div class="gap-xs flex items-center border-subtlest ring-subtlest divide-subtlest bg-transparent"><button
aria-label="Helpful" data-state="closed" type="button" class="reset interactable select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out
font-sans text-center items-center justify-center leading-loose whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm
cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo inline-flex rounded-full aspect-square p-0 aspect-[9/8] hover:text-foreground
hover:bg-subtle"><div class="relative flex items-center justify-center"><div style="opacity: 1; transition: opacity 150ms 150ms;" class="inline-flex"><svg role="img"
class="inline-flex fill-current" width="16" height="16"><use xlink:href="#pplx-icon-thumb-up"></use></svg></div><div style="opacity: 0; transition: opacity 150ms;"
class="absolute inset-0 flex items-center justify-center"></div></div></button><button aria-label="Not helpful" data-state="closed" type="button" class="reset interactable
select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out font-sans text-center items-center justify-center leading-loose whitespace-nowrap
data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97] active:duration-150 active:ease-outExpo
inline-flex rounded-full aspect-square p-0 aspect-[9/8] hover:text-foreground hover:bg-subtle"><div class="relative flex items-center justify-center"><div style="opacity: 1;
transition: opacity 150ms 150ms;" class="inline-flex"><svg role="img" class="inline-flex fill-current" width="16" height="16"><use
xlink:href="#pplx-icon-thumb-down"></use></svg></div><div style="opacity: 0; transition: opacity 150ms;" class="absolute inset-0 flex items-center
justify-center"></div></div></button></div></span><div><button data-state="closed" aria-label="More actions" aria-expanded="false" aria-haspopup="menu" type="button"
class="reset interactable select-none [-webkit-user-drag:none] outline-none font-semimedium duration-300 ease-out font-sans text-center items-center justify-center
leading-loose whitespace-nowrap data-[state=open]:text-foreground data-[state=open]:bg-subtle text-quiet h-8 text-sm cursor-pointer origin-center active:scale-[0.97]
active:duration-150 active:ease-outExpo inline-flex rounded-full aspect-square p-0 hover:text-foreground hover:bg-subtle"><svg role="img" class="inline-flex fill-current"
width="16" height="16"><use xlink:href="#pplx-icon-dots"></use></svg></button></div></div></div></div></div></div></div></div><div class="gap-y-lg flex flex-col
first:mt-0"></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-shopping" hidden=""
id="radix-:r4l:-content-shopping" tabindex="0" class="focus:outline-none"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel"
aria-labelledby="radix-:r4l:-trigger-hotels" hidden="" id="radix-:r4l:-content-hotels" tabindex="0" class="focus:outline-none"></div><div data-state="inactive"
data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-places" hidden="" id="radix-:r4l:-content-places" tabindex="0"
class="focus:outline-none"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-jobs" hidden=""
id="radix-:r4l:-content-jobs" tabindex="0" class="focus:outline-none"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel"
aria-labelledby="radix-:r4l:-trigger-videos" hidden="" id="radix-:r4l:-content-videos" tabindex="0" class="focus:outline-none"></div><div data-state="inactive"
data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-images" hidden="" id="radix-:r4l:-content-images" tabindex="0"
class="focus:outline-none"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-:r4l:-trigger-sources" hidden=""
id="radix-:r4l:-content-sources" tabindex="0" class="focus:outline-none"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel"
aria-labelledby="radix-:r4l:-trigger-assets" hidden="" id="radix-:r4l:-content-assets" tabindex="0" class="focus:outline-none"></div></div>`
```