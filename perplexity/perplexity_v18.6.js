javascript:(function%20()%20%7B%0A%20%20%20%20const%20d%20%3D%20document%3B%0A%20%20%20%20const%20w%20%3D%20m%20%3D%3E%20new%20Promise(r%20%3D%3E%20setTimeout(r%2C%20m))%3B%0A%0A%20%20%20%20%2F%2F%20Markdown%20converter%20-%20converts%20HTML%20to%20Markdown%0A%20%20%20%20const%20md%20%3D%20n%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20if%20(3%20%3D%3D%20n.nodeType)%20return%20n.textContent.replace(%2F%5Cs%2B%2Fg%2C%20%22%20%22)%3B%0A%20%20%20%20%20%20%20%20if%20(1%20!%3D%3D%20n.nodeType)%20return%20%22%22%3B%0A%0A%20%20%20%20%20%20%20%20let%20t%20%3D%20n.tagName.toLowerCase()%2C%20c%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20Array.from(n.childNodes).forEach(k%20%3D%3E%20c%20%2B%3D%20md(k))%3B%0A%0A%20%20%20%20%20%20%20%20if%20(%5B%22p%22%2C%20%22div%22%2C%20%22h1%22%2C%20%22h2%22%2C%20%22h3%22%2C%20%22h4%22%5D.includes(t))%0A%20%20%20%20%20%20%20%20%20%20%20%20c%20%3D%20%22%5Cn%5Cn%22%20%2B%20c%20%2B%20%22%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22li%22%20%3D%3D%20t)%20c%20%3D%20%22%5Cn-%20%22%20%2B%20c.trim()%3B%0A%20%20%20%20%20%20%20%20if%20(%22strong%22%20%3D%3D%20t%20%7C%7C%20%22b%22%20%3D%3D%20t)%20return%20%22%20**%22%20%2B%20c.trim()%20%2B%20%22**%20%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22em%22%20%3D%3D%20t%20%7C%7C%20%22i%22%20%3D%3D%20t)%20return%20%22%20*%22%20%2B%20c.trim()%20%2B%20%22*%20%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22a%22%20%3D%3D%20t)%20return%20%22%20%5B%22%20%2B%20c.trim()%20%2B%20%22%5D(%22%20%2B%20n.href%20%2B%20%22)%20%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22img%22%20%3D%3D%20t)%20return%20%22%5Cn!%5Bimg%5D(%22%20%2B%20n.src%20%2B%20%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22code%22%20%3D%3D%20t)%20return%20%22%20%60%22%20%2B%20c%20%2B%20%22%60%20%22%3B%0A%20%20%20%20%20%20%20%20if%20(%22pre%22%20%3D%3D%20t)%20return%20%22%5Cn%60%60%60%5Cn%22%20%2B%20n.innerText%20%2B%20%22%5Cn%60%60%60%5Cn%22%3B%0A%20%20%20%20%20%20%20%20if%20(t.startsWith(%22h%22))%20return%20%22%5Cn%22%20%2B%20%22%23%22.repeat(parseInt(t%5B1%5D))%20%2B%20%22%20%22%20%2B%20c.trim()%20%2B%20%22%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20return%20c%3B%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20async%20function%20x()%20%7B%0A%20%20%20%20%20%20%20%20let%20o%20%3D%20%22%23%20Perplexity%20Report%20v18.6%5Cn%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20METADATA%0A%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20Metadata%5Cn%22%3B%0A%20%20%20%20%20%20%20%20o%20%2B%3D%20%22-%20**Date**%3A%20%22%20%2B%20new%20Date().toISOString()%20%2B%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20o%20%2B%3D%20%22-%20**URL**%3A%20%22%20%2B%20window.location.href%20%2B%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20o%20%2B%3D%20%22-%20**Title**%3A%20%22%20%2B%20document.title%20%2B%20%22%5Cn%5Cn---%5Cn%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20PROMPT%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20h%20%3D%20d.querySelector(%22h1%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(h)%20o%20%2B%3D%20%22%23%23%20Prompt%5Cn%22%20%2B%20h.innerText.trim()%20%2B%20%22%5Cn%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20PER-MESSAGE%20REASONING%20(NEW%20IN%20v18.2)%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20reasoningButtons%20%3D%20Array.from(d.querySelectorAll(%22button%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.filter(x%20%3D%3E%20%2F%5Cd%2B%5Cs%2Bsteps%5Cs%2Bcompleted%2Fi.test(x.innerText))%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(reasoningButtons.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20Per-Message%20Reasoning%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20reasoningButtons.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20btn%20%3D%20reasoningButtons%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20stepCount%20%3D%20btn.innerText.match(%2F%5Cd%2B%2F)%5B0%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Click%20to%20expand%20reasoning%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20btn.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(3000)%3B%20%2F%2F%20Wait%203%20seconds%20for%20content%20to%20load%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Find%20reasoning%20steps%20using%20v17%20approach%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20buttonParent%20%3D%20btn.closest('%5Bid%5E%3D%22radix%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20stepsFound%20%3D%20false%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(buttonParent)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Look%20for%20.group%2Fgoal%20elements%20(reasoning%20steps)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20goalSelectors%20%3D%20%5B'.group%5C%5C%2Fgoal'%2C%20'%5Bclass*%3D%22group%22%5D%5Bclass*%3D%22goal%22%5D'%2C%20'%5Bclass*%3D%22reasoning%22%5D'%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20gs%20%3D%20null%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Try%20each%20selector%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20sel%20of%20goalSelectors)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gs%20%3D%20buttonParent.querySelectorAll(sel)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(gs%20%26%26%20gs.length%20%3E%200)%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(gs%20%26%26%20gs.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%23%20Message%20%22%20%2B%20(i%20%2B%201)%20%2B%20%22%20(%22%20%2B%20stepCount%20%2B%20%22%20steps)%5Cn%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gs.forEach((g%2C%20stepIndex)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Get%20step%20description%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20t%20%3D%20g.querySelector(%22.pr-sm%2C%20%5Bclass*%3D'pr-sm'%5D%2C%20%5Bclass*%3D'text'%5D%2C%20p%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(t%20%26%26%20t.innerText.trim()%20!%3D%3D%20%22Finished%22%20%26%26%20t.innerText.trim().length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%23%23%20Step%20%22%20%2B%20(stepIndex%20%2B%201)%20%2B%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20t.innerText.trim()%20%2B%20%22%5Cn%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Get%20search%20queries%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20sq%20%3D%20Array.from(g.querySelectorAll(%22.bg-subtler%2C%20%5Bclass*%3D'subtler'%5D%2C%20%5Bclass*%3D'query'%5D%22))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(sq.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20qt%20%3D%20sq.map(el%20%3D%3E%20el.innerText.replace(%2Fsearch%2Fgi%2C%20%22%22).trim()).filter(t%20%3D%3E%20t.length%20%3E%200)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(qt.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%3E%20**Queries%3A**%20%22%20%2B%20qt.join(%22%2C%20%22)%20%2B%20%22%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Get%20source%20links%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20l%20%3D%20Array.from(g.querySelectorAll(%22a%22))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(l.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20l.forEach(link%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(link.href%20%26%26%20!link.href.includes(%22perplexity%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20linkText%20%3D%20link.innerText.replace(%2F%5Cn%2Fg%2C%20%22%20%22).trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(linkText.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22-%20%5B%22%20%2B%20linkText%20%2B%20%22%5D(%22%20%2B%20link.href%20%2B%20%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stepsFound%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!stepsFound)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%23%20Message%20%22%20%2B%20(i%20%2B%201)%20%2B%20%22%20(%22%20%2B%20stepCount%20%2B%20%22%20steps)%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%3E%20Unable%20to%20extract%20reasoning%20steps%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Optional%3A%20collapse%20back%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20btn.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20await%20w(500)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22Error%20extracting%20reasoning%3A%22%2C%20e)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%3E%20Error%20extracting%20per-message%20reasoning%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20ANSWER%20(with%20artifact%20filtering)%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20c%20%3D%20d.querySelectorAll('%5Bid%5E%3D%22markdown-content%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(c.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20Answer%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Filter%20out%20artifacts%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20artifacts%20%3D%20%5B%22Chart%22%2C%20%22Code%20Interpreter%20Graph%22%2C%20%22Code%20Interpreter%22%2C%20%22Programming%2C%20Chart%22%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c.forEach(z%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20text%20%3D%20md(z)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Remove%20artifact%20lines%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.split('%5Cn')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.filter(line%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20trimmed%20%3D%20line.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20!artifacts.some(a%20%3D%3E%20trimmed%20%3D%3D%3D%20a)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.join('%5Cn')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Clean%20up%20multiple%20empty%20lines%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20%3D%20text.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20'%5Cn%5Cn')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20text%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20SIDEBAR%20SOURCES%20(legacy)%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20sb%20%3D%20Array.from(d.querySelectorAll(%22button%22)).find(x%20%3D%3E%20%2F%5Cd%2B%5Cs%2Bsources%2Fi.test(x.innerText))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(sb)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sb.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(2000)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20sl%20%3D%20d.querySelectorAll(%22div.h-full%20a%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(sl.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20All%20Sources%20(Combined)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20u%20%3D%20new%20Set()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sl.forEach(l%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(l.href%20%26%26%20!l.href.includes(%22perplexity%22)%20%26%26%20!u.has(l.href))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u.add(l.href)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22*%20%5B%22%20%2B%20l.innerText.split(%22%5Cn%22)%5B0%5D%20%2B%20%22%5D(%22%20%2B%20l.href%20%2B%20%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20cls%20%3D%20d.querySelector('button%5Bdata-testid%3D%22close-modal%22%5D')%20%7C%7C%20d.querySelector('button%5Baria-label%3D%22Close%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(cls)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cls.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(1000)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(%22Close%20btn%20missing%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%3E%20Error%20Sidebar%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20IMAGES%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20ti%20%3D%20Array.from(d.querySelectorAll(%22button%5Brole%3D'tab'%5D%2C%20div%5Brole%3D'tab'%5D%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.find(t%20%3D%3E%20%2FImages%7CMedia%2Fi.test(t.innerText)%20%7C%7C%20t.querySelector('use%5Bxlink%5C%5C%3Ahref*%3D%22icon-image%22%5D'))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(ti)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20Images%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ti.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(2500)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Wait%20for%20images%20to%20load%20with%20better%20checking%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20attempts%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20maxAttempts%20%3D%2020%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(attempts%20%3C%20maxAttempts)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20loadedCount%20%3D%20Array.from(d.querySelectorAll(%22img%5Bsrc*%3D'http'%5D%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.filter(img%20%3D%3E%20img.complete%20%26%26%20img.naturalWidth%20%3E%200).length%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(loadedCount%20%3E%200)%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(500)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20attempts%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20im%20%3D%20d.querySelectorAll(%22img%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20us%20%3D%20new%20Set()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20im.forEach(m%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(m.src%20%26%26%20!m.src.includes(%22favicon%22)%20%26%26%20m.naturalWidth%20%3E%20100%20%26%26%20!us.has(m.src))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20us.add(m.src)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22!%5Bref%5D(%22%20%2B%20m.src%20%2B%20%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20RELATED%20QUESTIONS%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Try%20to%20find%20related%20questions%20section%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20relatedSelectors%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%5Bdata-testid%3D%22related-questions%22%5D'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'.related-questions'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%5Bclass*%3D%22related%22%5D'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%5Bclass*%3D%22follow-up%22%5D'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%5Bclass*%3D%22followup%22%5D'%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(const%20selector%20of%20relatedSelectors)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20rq%20%3D%20d.querySelector(selector)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(rq)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20questions%20%3D%20rq.querySelectorAll('a%2C%20button%2C%20%5Brole%3D%22button%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(questions.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn---%5Cn%5Cn%23%23%20Related%20Questions%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20questions.forEach((q%2C%20i)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20text%20%3D%20q.innerText.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(text%20%26%26%20text.length%20%3E%2010)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20(i%20%2B%201)%20%2B%20%22.%20%22%20%2B%20text%20%2B%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20DOWNLOAD%0A%20%20%20%20%20%20%20%20let%20bl%20%3D%20new%20Blob(%5Bo.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20%22%5Cn%5Cn%22)%5D%2C%20%7B%20type%3A%20%22text%2Fmarkdown%22%20%7D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20el%20%3D%20d.createElement(%22a%22)%3B%0A%20%20%20%20%20%20%20%20el.href%20%3D%20URL.createObjectURL(bl)%3B%0A%20%20%20%20%20%20%20%20el.download%20%3D%20%22perplexity_v18.6_%22%20%2B%20new%20Date().toISOString().slice(0%2C%2010)%20%2B%20%22.md%22%3B%0A%20%20%20%20%20%20%20%20d.body.appendChild(el)%3B%0A%20%20%20%20%20%20%20%20el.click()%3B%0A%20%20%20%20%20%20%20%20d.body.removeChild(el)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20PER-MESSAGE%20SOURCES%20(moved%20to%20end%20in%20v18.6)%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20sourceButtons%20%3D%20Array.from(d.querySelectorAll(%22button%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.filter(x%20%3D%3E%20%2F%5Cd%2B%5Cs%2Bsources%2Fi.test(x.innerText))%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(sourceButtons.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%20Per-Message%20Sources%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20sourceButtons.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20btn%20%3D%20sourceButtons%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20sourceCount%20%3D%20btn.innerText.match(%2F%5Cd%2B%2F)%5B0%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%23%23%23%20Message%20%22%20%2B%20(i%20%2B%201)%20%2B%20%22%20(%22%20%2B%20sourceCount%20%2B%20%22%20sources)%5Cn%22%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20btn.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(2000)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20sl%20%3D%20d.querySelectorAll(%22div.h-full%20a%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(sl.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20u%20%3D%20new%20Set()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sl.forEach(l%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(l.href%20%26%26%20!l.href.includes(%22perplexity%22)%20%26%26%20!u.has(l.href))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20u.add(l.href)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22*%20%5B%22%20%2B%20l.innerText.split(%22%5Cn%22)%5B0%5D%20%2B%20%22%5D(%22%20%2B%20l.href%20%2B%20%22)%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20cls%20%3D%20d.querySelector('button%5Bdata-testid%3D%22close-modal%22%5D')%20%7C%7C%20d.querySelector('button%5Baria-label%3D%22Close%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(cls)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cls.click()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20w(1000)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22---%5Cn%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20o%20%2B%3D%20%22%3E%20Error%20extracting%20per-message%20sources%5Cn%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%7D%0A%20%20%20%20x()%3B%0A%7D)()%3B